"issuekey","type","components","storypoint","title","description_text"
"CONFSERVER-53001","Bug","Editor - Page / Comment Editor",3,"Pressing menu key causes the editor to jump to the top","""Steps to replicate :  # Login to Confluence  # Copy the text generated from the following page to a Confluence page to the point where you would need to scroll :  http://www.lipsum.com/feed/html  # After adding the text, please scroll to the bottom of the editor  # Click on the menu key, you can find the picture of the menu key in case you have trouble finding it :  !key.png|thumbnail!    Current behavior : the cursor jump to the top of editor  Expected behavior :  the cursor should not jump to the top of the editor and should open normal internet browser context menu (like you would have pressed a right click in a web page).  """
"CONFSERVER-52991","Bug","Data Center - Deployments",3,"Synchrony could not start on some AWS regions (e.g. Ohio)","""When attempting to deploy Confluence to some AWS regions Synchrony will not start properly because of AWS API using the wrong endpoint. The effected regions are:   * US East (Ohio) - us-east-2   * EU (London) - eu-west-2 _- See Note 1_   * Asia Pacific (Mumbai) - ap-south-1 _- See Note 1_   * Asia Pacific (Seoul) - ap-northeast-2 _- See Note 1_   * Canada (Central) - ca-central-1 _- See Note 1_    Note 1: presently does not support EFS which is required to deploy on AWS using the Atlassian CloudFormation template  h3. Workaround    a. Use a different region to deploy Confluence    or    b. Do not deploy Synchrony and disable Collaborative Editing in Confluence"""
"CONFSERVER-52990","Bug","Site - Backup / Import",5,"Cloud to Server export users can't log in","""{panel:title=Atlassian Update|borderStyle=solid|borderColor=#3c78b5|titleBGColor=#3c78b5|bgColor=#e7f4fa}  The fix shipped in 6.5.1 added [Restore Passwords To Recover Admin User Rights|https://confluence.atlassian.com/doc/restore-passwords-to-recover-admin-user-rights-158390.html].  This method can be used to recover an administrator account in cases like this and other cases. The documentation [Migrate from Confluence Cloud to Server|https://confluence.atlassian.com/doc/migrate-from-confluence-cloud-to-server-298979321.html] has also been updated.  {panel}  h2. Summary    Backup taken from Cloud doesn't allow users to login after import in Server.    Credentials *sysadmin* username/password as mentioned on [Migrate from Confluence Cloud to Server - Atlassian Documentation|https://confluence.atlassian.com/doc/migrate-from-confluence-cloud-to-server-298979321.html] don't work.  h2. Environment   * Confluence Cloud    h2. Steps to Reproduce   # Create a Confluence Cloud export   # Install latest Confluence Server   # On the set up page, use the Cloud XML export to import a full site   # Log in as *sysadmin*/*sysadmin*    h2. Expected Results    *sysadmin* user is able to login using password *sysadmin*  h2. Actual Results    *sysadmin* user is not able to login.  h2. Notes    The export doesn't contain the passwords for any of the users.    The *sysadmin* account is not fully created. There is no entry for *sysadmin* in {{cwd_user}} table and no {{cwd_membership}} table entries, but there is a *sysadmin* entry in the {{user_mapping}} table.  h2. Workaround    See   * [Restoring Passwords To Recover Admin User Rights|https://confluence.atlassian.com/doc/restore-passwords-to-recover-admin-user-rights-158390.html]    To add an *admin* user to the database with password *admin*   # Shutdown Confluence   # Run this SQL insert to create the *admin* user with password *admin*       # Add the *admin* user to the *confluence-users* and *confluence-administrators* groups       # Restart Confluence   # Log in as user *admin* with password *admin*"""
"CONFSERVER-53040","Bug","Apps - Team Calendar",3,"Team Calendars throws exception when get external calendar data and run on Confluence CDC","""The current implementation of CacheLoader in TC returns Object as empty value. It only works on memory cache and it does not work on Hazelcast because Object does not implement Serializable"""
"CONFSERVER-53013","Bug","Space - Export / Import",3,"Calling ImportExportManager.doImport with a space export without setting the space key rebuilds the entire ancestor table","""Code to reproduce:        The Confluence code that causes the issue is in com.atlassian.confluence.pages.ancestors.RebuildAncestorsPostImportTask#rebuildPageAncestors"""
"CONFSERVER-53055","Bug","Content - Restrictions",5,"Rebuild of the CONFANCESTORS table does not write to the database in batches","""The process to [rebuild the CONFANCESTORS table|https://confluence.atlassian.com/doc/rebuilding-the-ancestor-table-153948.html] operates in batches, but it does not write those batches to the database as it progresses. It writes them all at once at the end of the job.    This, when combined with slowness (eg caused by CONFSERVER-53054) can cause the process to be interrupted by a restart etc, which leaves the table completely empty, and no inherited permissions are applied.    NB: Even after logging {{Ancestors persisted to database in 507875 ms}}, the table is still at 0."""
"CONFSERVER-53081","Bug","Macros - Gadgets",3,"Activity Stream gadget throws ""The resource rest/webResources/1.0/resources, cannot be found."" error","""h2. *How to reproduce this problem*    Have Confluence 6.2.3 + JIRA 7.3.8 installed and configured with application links:   # Create a dashboard in JIRA   # Click Add Gadget, then Manage gadgets to add the Activity Stream Gadget with the gadget URL served from confluence   # Add the *Activity Stream Gadget* to a JIRA dashboard, and observe the error message about resource cannot be found.    The issue could be reproduced by adding the Activity Stream gadget into a page in confluence.  h2. *Diagnosis*    Within *Jira*:   # Navigate to *Jira Administration* » *System* » *Logging and profiling*   ** Enable *HTTP Access logging*    Within *Confluence*:   # Add the *Activity Stream Gadget* to a JIRA dashboard, and observe the error message about resource cannot be found.    On *Jira side*:   # Open up {{$JIRA_HOME/log/atlassian-jira-http-access.log}}   # Search for *{{rest/webResources/1.0/resources}}*     # You can see that the URL requested into Jira by confluence has the Jira web context """"*/jira*"""" incorrectly added twice resulting in a *HTTP 404 Not Found Error*    h2. *Cause*    Confluence is incorrectly doubling up the Jira web context path when hitting the Jira *{{rest/webResources/1.0/resources}}* REST call.    h2. *Workaround*    Some people are able to work around the issue by creating a redirect rule as follows:    Pattern: \bconfluence/(\bconfluence.*)   Rewrite URL: http://localhost:8090/\{R:1}    Essentially chopping off the second /confluence.  NOTE: You must move this rule above the rewrite rule that sends normal traffic to confluence.    The same for double jira."""
"CONFSERVER-53188","Bug","Apps - Team Calendar",3,"Some Team Calendar notifications aren't set with a date parse error","""h3. Summary  Team Calendar notifications aren't sent due to a date parse error.    In {{atlassian-confluence.log}} this error is thrown, there is no stack trace, just this  {code:title=atlassian-confluence.log}  2017-08-13 13:04:37,468 WARN [http-nio-8090-exec-4] [extra.calendar3.util.TimeZoneUtil] tryParseDateTimeStringForEventEdit Unable to parse date    -- referer: http://confluence.mycompany.com:8090/calendar/mycalendar.action | url: /rest/calendar-services/1.0/calendar/events.json | traceId: cf06ed098f41e2a7 | userName: userXYZ  {code}    h3. Environment  * Team Calendar 5.3.19  * SMTP configured    h3. Steps to Reproduce  # Log in as *usera*  # Create an all day event, not repeating  # Add *usera* as first invitee (with email address usera@mycompany.com)  # Add *userb* as second invitee (with email address userb@mycompany.com)  # Click *Ok*    h3. Expected Results  All added users get an email notifying of the event    h3. Actual Results  The below exception is thrown in the {{atlassian-confluence.log}} file:    The user mentioned in the log does not receive the email, the other users do.    h3. Notes  This seems to be only affecting some users. On testing with 2 users exactly the same, one receives the email and the other doesn't. This is reliable. The error is from this exception  {code:language=java|title=team-calendars/src/main/java/com/atlassian/confluence/extra/calendar3/util/TimeZoneUtil.java}          catch (Exception iae)          {              LOG.warn(""""Unable to parse date """" + date + (StringUtils.isNotBlank(time) ? """" time """" + time : """"""""));              LOG.debug(""""Exception when parsing date:"""", iae);              return null;          }  {code}  Based on the error we can see, the date is blank.    Code was introduced with  * [TEAMCAL-3764 - refactoring update event logic in CalendarRestResouce to make it more maintianable|https://jira.atlassian.com/browse/TEAMCAL-3764]    However, the bug is likely elsewhere as this code is using date that is sent to it.    h3.Workaround  Add all other users and save the event. Have another user add yourself to the event."""
"CONFSERVER-53203","Bug","Data Center - Core",3,"Logs flooded excessively with ""Hazelcast instance is not active!"" once Hazelcast has shut down","""h2. Problem description  In a Data Center configuration, if Hazelcast is shut down on a node (e.g. in a cluster panic) the logs are quickly flooded with stacktraces like the below:      These stacktraces are recorded at the rate of tens/hundreds of times per minute and can quickly fill up the default log configuration of ~120 MB of atlassian-confluence.log files with nothing but these entries. The logs can roll in a matter of minutes.    The reason this is a problem is that it can cause the root cause of the node shutting down (e.g. the cluster panic event) to be rolled off the logs way before administrators have a chance to react/intervene to recover the node or manually pull the logs before rolling off. In other words, this flood of logging can hamper efforts for root cause analysis for large clients.    Ideally, we can log this type of stacktrace *once* and minimize the verbosity future entries of a similar type instead of repeatedly logging the stacktrace.    h2. Workaround  The current workaround is to extend the default logging so that more logs are kept in archive, in order to give administrators a greater window to capture the relevant logs. This can be done my modifying the following two parameters in <confluence_install>/confluence/WEB-INF/classes/log4j.properties, which influences size of log files and number of logs kept in archive, respectively:      Note however that increasing the logs kept will impact the disk footprint and size of Support Zips generated."""
"CONFSERVER-53278","Bug","Content - Tasks|Macros - JIRA Macros",3,"Linked Jira issue details are not loading on Confluence tasks lists.","""h3. Summary    When you have more than 15 tasks with JIM(JIRA Issue Macro), the Confluence task list can't get the JIRA details.     h3. Environment  * Confluence 6.2.3  * JIRA 7.3.7    h3. Steps to Reproduce  # Go to JIRA.  # Create a new JIRA ticket for this test(it must be a ticket that was never inserted in Confluence).  # Go to Confluence.  # Create a new page and insert a task(for the admin user and with a JIM with the new ticket).  #* Copy and paste the task, it must have more than 15 or 20 to reproduce the issue.  # In Confluence, click on the profile of the user and select """"Task"""" menu.    h3. Expected Results  All the JIM details will be rendered.    h3.Notes  - Rebuilding the indexing of the content won't resolve.  - Flushing the cache won't resolve.    h3. Actual Results   !JIM.png|thumbnail!   h3.Workaround  Restart Confluence.  """
"CONFSERVER-53404","Bug","Editor - Collaborative editing",2,"Relation timestamp is incorrectly updated on the old version of a page when it is published","""h2. Steps to reproduce   * Create a page and publish it.   * Observe the time on the collaborator relations on the page.   * Update the page and publish it.   * Check the time on the collaborator relationships on the old version of the page. It shows the current time instead of the original time.    h2. Explanation and actual behaviour    Because of the way versioning works in Confluence, during a page publish we:   * Create a copy of the latest published version of the page   * Create the collaborator relationships on the new page object which has the old published version of the page   * Update the current version of the page in place   * Update the collaborator relationships for the current version    If you publish a new version of an already published page, the relations created on the old version of the page have the current time instead of the times on the original collaborator relationships. This is a bug.  h2. Expected behaviour    The time of the collaborator relationship on the previous version of the page does not change.  h2. Workarounds    No workaround exists.     """
"CONFSERVER-53381","Bug","Data Center - Core|Server - Jobs",5,"Frequent deadlocks on the scheduler_run_details table can cause an outage","""{panel:title=Resolution|borderStyle=solid|borderColor=#3C78B5|titleBGColor=#3C78B5|bgColor=#E7F4FA}  A [Scheduled Job|https://confluence.atlassian.com/doc/scheduled-jobs-96567525.html] called 'Purge Old Job Run Details' has been introduced to purge scheduled job history    {panel}    h2. Summary    Frequent deadlocks on the scheduler_run_details table can cause an outage.    The scheduler_run_details table holds the job execution history for both clustered and non-clustered jobs. When a deadlock occurs on this table it prevents the job history from being updated and eventually leads to an outage.  h2. Environment   * Confluence Data Center   * Confluence server Standalone   * Microsoft SQL Server   ** Transaction isolation level [READ_COMMITTED_SNAPSHOT|https://confluence.atlassian.com/doc/database-setup-for-sql-server-9258.html]   ** [Collation|https://confluence.atlassian.com/confkb/how-to-fix-the-collation-of-a-microsoft-sql-server-confluence-database-687216725.html] has been verified correct   * MySQL database   * PostgreSQL database   * Large number of records in the scheduler_run_details table    h2. Symptoms  h4. Application logs      (i) The job name and ID will vary, as this can happen to any non-clustered job in the Confluence cluster.  h4. DB logs    The DB error logs will look similar to what you see here:    Confirm if there is table scanning by running an execution plan against the delete queries - see [Displaying Graphical Execution Plans (SQL Server Management Studio)|https://technet.microsoft.com/en-us/library/ms178071(v=sql.105).aspx] from MS documentation for details of how this can be done in your environment.  h2. Details of the problem    It is possible that multiple nodes are updating the table concurrently, because the table is not for clustered job.    The current implementation of SchedulerRunDetailsDao increases contention as it does purge (delete outdated job details) every time when a new record is added to the table:      Normally, the database should be able to handle these kind of concurrent transactions (as we are deleting things rather than updating the same record). However, it is not handled perfectly by MS SQL Server or MySQL. The situation is escalated and one transaction is chosen to be rolled back as a deadlock victim. This may lead to other symptoms.    These are two queries frequently being deadlocked:    The lack of the indexes is very likely to cause a full table scan during the execution of the delete statements. Adding the indexes in the workaround should significantly reduce the chance of deadlocks.    And another thing is, the design of addRunDetails is not optimal. The purge should be implemented as a cluster wide job rather than part of the add logic. It would eliminate contention completely. Or at least it should be made less frequent (on a daily basis, for example).  h2. Workaround  h4. Option 1    Add the following 2 composite indexes to the SCHEDULER_RUN_DETAILS table, based on the predicates of the two delete statements.    h4. Option 2    After performing the above, deadlocks are still possible if the size of the table is very large (i.e. over 100k rows) due to the frequency of the purge request.    You can try deleting entries in the scheduler_run_details older than 1 day. The SQL query to do this would be something like below, replacing the date with one day ago:    (!) *Important:* You should not run this in production without first testing in your staging environment. You should also take a database backup or dump prior to running this in production. If anything does not work as expected, you can then restore from the backup.    h4. Option 3    You may also try to apply one of the below DB changes:   # Disable lock escalation for the table scheduler_run_details   # Disable page lock for the table scheduler_run_details    The final option would prevent the possibility of a deadlock caused by concurrent purges. Since the purged jobs are obsolete, this shouldn't be a problem. See also the below articles for more details on this:   * [http://www.sqlpassion.at/archive/2016/10/31/disabling-row-and-page-level-locks-in-sql-server/]   * [https://stackoverflow.com/questions/15073547/avoid-deadlock-for-concurrent-delete]    (i) Your DBA may have some experience in these options too."""
"CONFSERVER-53408","Bug","Editor - Drafts|Navigation - Dashboard",2,"Infinite scrolling sometimes does not work on the dashboard","""Currently the dashboard fetches 20 pages at a time and if less than 20 results are returned, it does not attempt to fetch more pages. However the backend can sometimes return fewer results. We should make this more robust by always fetching more pages until an empty page is returned."""
"CONFSERVER-53407","Bug","Editor - Drafts|Navigation - Dashboard",1,"Items in the dashboard recently worked on sometimes move around","""Items in the recently worked on section of the dashboard sometimes move around. This is caused by the last modified date for the user sometimes being newer than the last contributed date. Currently the last contributed date is always used when present. We should use the newer date instead."""
"CONFSERVER-53469","Bug","Macros - JIRA Macros",2,"Insert JIRA Macro - Timeout while getting placeholder, Rendering this content exceeded the timeout of 5 seconds","""h4. Summary    When using JIRA macro (with Total issue count selected in the Display options), displays Error 'Timeout while getting placeholder. Please try again shortly.'  when inserting the macro and the Confluence logs logged the message """"Rendering this content exceeded the timeout of 5 seconds."""" even if {{confluence.macro.placeholder.timeoutMillis}} is set.  h4. Steps to reproduce   # Create a page and Insert JIRA issue macro   # Use JQL similar to \{\{project=confserver and issuetype=""""bug"""" and status was Open after -5d}} (note: This JQL took 7.5 seconds to return data from JAC)   # Select Total Issue count from the Display options drop down in JIRA issues macro   # Insert the Macro    # After 5 seconds, Editor throws an error """"Timeout while getting placeholder, Please try again shortly"""", Confluence logs logged the message """"Rendering this content exceeded the timeout of 5 seconds.   # Set the system property value to change the default timeout from 5 seconds to much higher value (It was set to 10 seconds for this test)   # *CATALINA_OPTS=""""-Dconfluence.macro.placeholder.timeoutMillis=<value> $\{CATALINA_OPTS}""""*   # Restart Confluence   # Repeat steps 1 to 4   # The page Editor still throws the same error """"Timeout while getting placeholder, Please try again shortly""""    h4. Expected Results    JIRA Macro should get inserted in the page without any errors  h4. Actual Results    The editor Errors out as  'Timeout while getting placeholder. Please try again shortly.'      It is observed the placeholder timeout value in the Javascript doesn't respect the confluence.macro.placeholder.timeoutMillis parameter and it defaults to 5 seconds.  h4. Workaround    No workaround     Need a fix or a workaround to allow Javascript macro placeholder timeout value to be increased.  h4.       """
"CONFSERVER-53500","Bug","Macros - JIRA Macros",5,"JIRA Issues macro fails with custom field","""JIRA macro does not load when a Custom Field is added as a Column to Display. After saving the page, the macro shows up as """"loading issues"""" with a spinning wheel. When it finally fails, the error message can be seen as in the screenshot, and the macro is greyed out.  h3. How to replicate    Created blank page on brand new Confluence instance, added one JIRA Issues macro containing a custom field (A) and another without the custom field (B) - *Macros break*  Edited macro A in order to remove the custom field - *Macros break*  Removed macro A and inserted another macro without the custom field (C) - *Macros render properly*  Edited macro B in order to add the custom field - *Macros break*  h3. Expected results    Macros render correctly in all cases.  h3. Actual results    Macros fail when there's a custom field on them.  h3. Workaround    If you are unable to upgrade, the Jira [Filter Results Gadget|https://confluence.atlassian.com/jira064/adding-the-filter-results-gadget-720416922.html] can be added to Confluence via [Registering External Gadgets|https://confluence.atlassian.com/doc/registering-external-gadgets-204050482.html] to load custom fields."""
"CONFSERVER-53513","Bug","User - Management",3,"Not able to delete new user after they login without editing any pages in confluence","""h3. Description    When a new user is created by admin in confluence, the admin will not be able to delete the user after the new user login to confluence and view some pages without editing any pages. Confluence will show an error to the admin saying that the user is not able to delete due to edited some pages in confluence.  *The issue can be reproduced on 6.2, 6.3 and 6.4.*    *Steps to reproduce*   # Login as confluence admin   # Go to *Users* page   # create a new user with the following details   ** username: atlassiantestu1   ** full name: atlassiantestu1   ** password: 1234   # Logout confluence   # Login confluence with the newly created user account *atlassiantestu1*   # Complete the setup and view some pages in confluence. (DO NOT CREATE OR EDIT ANy PAGES)   # Logout confluence   # Login as confluence admin and try to delete the atlassiantestu1 user   (i) For details, you may refer to the video   [^Recording #31.mp4]    Expected Result   The user will be deleted.    Actual Result   !screenshot-1.png|thumbnail!"""
"CONFSERVER-53535","Bug","Apps - Confluence Questions|User - Mentions",2,"Mentioning user didn't work when creating new question","""h3. Summary    Mentioning user didn't work when creating a new question.  It worked when editing a question, answering to a question and commenting on a question as expected.    h3. Environment    * Questions for Confluence 2.4.19    h3. Steps to Reproduce    # Open create question screen  # Mention any user in the editor (e.g. Type """"@Test User"""")  # Press _Save_ button    h3. Expected Results    The user should be mentioned.    h3. Actual Results    The user was not mentioned and it was shown as just a link for the user profile. (The notification wasn't sent to the user.)     !create_question.png|thumbnail!     If you edit the question and mention the user in the description, the user is mentioned as expected.     !edit_question.png|thumbnail!     h3. Notes    * This problem didn't seem to happen on Questions for Confluence 2.4.15    h3.Workaround    There is no workaround."""
"CONFSERVER-53573","Bug","Navigation - Space Directory",2,"Underscore prevents search in space directory","""Summary    Space directory search filters fails with underscore    Environment  Confluence version : 5.10.x and I was able to reproduce on 6.1.3.  No plugins no proxy used no SSL    Browser versions:  •  All 3 browsers are affected     Steps to Reproduce  1. Log in to confluence  2. Navigate to space directories when searching with space name that contains _ nothing is found  3. Tested with dash and results were showing  Screen shots showing:    1.full list of spaces   2. result of underscore- not showing output   3. result with dash filter- showing output  Expected Results  To have results similar to dash"""
"CONFSERVER-59486","Bug","Macros - JIRA Macros",3,"Team name should be shown in REST API/Confluence macros instead of just the Team ID","""Right now, when adding a Issue filter macro to Confluence, the team column has team IDs instead of team names. A similar behaviour applies to XML exports.    The team column should follow a behaviour similar to Agile Sprints, where the name is shown in the column."""
"CONFSERVER-53651","Bug","Server - Platform",5,"HTTP Client in Confluence does not accept RFC6265 compliant date format in ""Expires"" cookie header","""{panel:bgColor=#deebff}  We closed this ticket because:   * It is too generic since there are different sources that could generate the same WARN messages.   * These WARN messages are mostly harmless and misleading on AWS because it currently returns a new a rotating cookie key to the client for every request and *the sticky session is not lost*.   * We have also verified that Confluence Data Center has been working properly behind an Nginx Plus Load Balancer with session affinity enabled.    For any specific case, we will open a new ticket to address it, such as CONFSERVER-56254. Please don't reference to this ticket but raise a new one if you can narrow down to which use case that causes the sticky session to be lost and the user is asked to log in again.  {panel}  h3. Summary    When using a load balancer, firewall or application that sets cookies with an {{expires}} attribute (not {{Max-Age}}) in a Cookie header, Confluence throws a WARN (in this example it's trying to get the data from a Jira User Server via the firewall)  {code:java}  2017-10-04 16:31:55,549 WARN [http-nio-8443-exec-45] [http.client.protocol.ResponseProcessCookies] processCookies Invalid cookie header: """"Set-Cookie: this_is_a_cookie=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA; e  xpires=Thu, 04 Oct 2018 12:31:45 GMT; path=/; Domain=.mycompany.com"""". Invalid 'expires' attribute: Thu, 04 Oct 2018 12:31:45 GMT  -- referer: https://confluence.mycompany.com/plugins/servlet/embedded-crowd/configure/jira/ | url: /plugins/servlet/embedded-crowd/configure/jira/ | traceId: 905ff3f698dd7782 | userName: username@mycompany.com  {code}  h3. Environment   * External firewall or loadbalancer that Confluence is connecting through    h3. Steps to Reproduce   # Set up a load balancer or firewall that sets cookies with an *expires* element on the {{Cookie:}} header   # Have Confluence pull content via load balancer    h3. Expected Results    Link is parsed without error  h3. Actual Results    The below exception is thrown in the {{atlassian-confluence.log}} file:    h3. Notes    This can be reproduced with Amazon ALB.  h3. Workaround    Bypass the firewall or load balancer, or make sure the external application does not return cookies with {{expires}} attribute."""
"CONFSERVER-54184","Bug","Content - Attachments",2,"Cannot delete Comments on Attachments","""h3. Steps:   # Upload an attachment like an image or PDF and insert it on a page.   # View the page and click the attachment to preview.   # Drag out an attachment comment and save it.   # Click the """"..."""" menu on the comment and click """"Delete""""    h3. What should have happened    the comment should be deleted.  h3. What actually happened    Nothing.  h3. Workaround    Resolve the comment."""
"CONFSERVER-53993","Bug","Editor - Collaborative editing|Editor - Synchrony|Server - Installer / Setup",2,"Unable to create/edit page after a fresh installation of Confluence with MS SQL Server. Synchrony could not load driverClass net.sourceforge.jtds.jdbc.Driver","""*STEPS TO REPLICATE*   # Install Confluence version 6.4.2 (using *atlassian-confluence-6.4.2.tar.gz* for this test)   # During the database setup, *Driver Class Name* is automatically set to use {{com.microsoft.sqlserver.jdbc.SQLServerDriver}} as per screenshot below:   !databasesetup.png|thumbnail!   # Enter the database URL and credential.   # Complete the installation.    *EXPECTED BEHAVIOUR*  User able to create a page after the installation.    *ACTUAL BEHAVIOUR*  Stack trace below appear in Confluence <HOME_directory>/logs/*atlassian-synchrony.log*:    User unable to create/edit page:   !erroredit.png|thumbnail!    *WORKAROUND*  update the jtds url to a correctly formatted Microsoft SQL Server driver url as per their documentation ([https://docs.microsoft.com/en-us/sql/connect/jdbc/building-the-connection-url]) :   # *Stop Confluence*   # Navigate to Confluence <HOME_directory>/*confluence.cfg.xml* file and replace the line below:    with:       # *Start Confluence*"""
"CONFSERVER-54000","Bug","Server - Installer / Setup",1,"During database setup, using a mismatched driver class and jdbc connection url does not fail the connection tests","""causes https://jira.atlassian.com/browse/CONFSERVER-53993    [See screehshot here|https://jira.atlassian.com/secure/attachment/295939/295939_databasesetup.png]    The connection test button will attempt to load the given driver class. However, the actual connection test may not utilize the given driver, but instead loads the driver associated with the jdbc url. In the case of CONFSERVER-53993, the JTDS drivers exists, and therefore, they are used. Thus passing the connection test.    The setup should ensure that only matching drivers and connection urls are saved."""
"CONFSERVER-54067","Bug","Server - Platform",5,"Confluence UI shows garbled or corrupt text on CAPTCHA, macros and/or diagrams due to missing fonts in Linux","""Macro header shows garbled text and weird symbols in Linux. Captcha appears warped and unreadable.    h6. Environment   # Linux distributions, especially RedHat (RHEL)  and CentOS   # Confluence v6 and above    h6. Steps to reproduce   # Insert any macro having a title, like the Panel Macro    h6. Expected Behavior  Macro header (the name of the macro) renders properly    h6. Actual Behavior  Strange characters appear in place of the macro name.    !macro-garbled.png|thumbnail!    h6. Workaround  # Stop Confluence  # Make one or both of the following changes:  #* Uninstall lyx-fonts package (Lyx/MathML fonts - A collection of Math symbol fonts for lyx) if it is installed on the server  #* Ensure the following fonts are installed:  {code:borderStyle=solid}  yum install ghostscript  yum install dejavu-fonts-common  yum install dejavu-sans-fonts  yum install dejavu-sans-mono-fonts  yum install motif    # Clear the plugin cache as described at  [How to clear Confluence plugins cache|https://confluence.atlassian.com/confkb/how-to-clear-confluence-plugins-cache-297664846.html]  # Rebuild the content index as described at [How to Rebuild the Content Indexes From Scratch on Confluence Server|https://confluence.atlassian.com/confkb/how-to-rebuild-the-content-indexes-from-scratch-on-confluence-server-110035351.html]  # Start Confluence  # Clear browser cache and verify fonts are displayed correctly    h6. Notes  Confluence requires some fonts to work in Linux distributions that are not included in the installation package or in the documentation as a requirement.    In some cases, the workaround also works for file previews such as Office files and PDF."""
"CONFSERVER-54063","Bug","Content - Restrictions",2,"Page Restrictions icon is red unlocked instead of grey unlocked when Editing is restricted","""h2. Steps   # Create a page.   # Add edit restrictions to it.   # Notice the lock icon is grey and unlocked.   # Refresh the page.   # Notice the lock icon is now red and unlocked (*which is wrong*).   # Click it to edit restrictions.   # Notice the icon has changed to gray.    h2. Expected    The Page Restrictions icon should not change (grey unlocked). Red unlocked means the page inherits restrictions from other pages.    This is behaviour prior to the introduction of the bug:  ||Restriction||Icon||  |None|Grey unlocked|  |Edit restriction only|Grey unlocked|  |Inherited view restriction|Red unlocked|  |Page view restriction|Red locked|    This might require a UX review. Documentation: [https://confluence.atlassian.com/doc/page-restrictions-139414.html]"""
"CONFSERVER-54093","Bug","User - Mentions",3,"Cursor focus is not automatically set in the text area when mentioning user in Chrome","""h3. Summary    Cursor focus is not automatically set in the text area when mentioning user in Chrome.   This problem was reproduced only in case that we mentioned users from the navigation menu _+ > User mention_. (If we mention users with """"@"""" shortcut, the problem is not reproduced.)  h3. Environment   * Chrome    h3. Steps to Reproduce   # Start to edit a page   # Click _+ > User mention_    h3. Expected Results    Cursor focus should be automatically set in the text area as in other browsers.  h3. Actual Results    Cursor focus was not automatically set in the text area. We need to click inside of the text area to input the user name.  !cursor.png|thumbnail!    h3. Notes    This problem seemed to be originally reported in -CONFSERVER-38633- but it was closed as """"Obsolete"""".  h3. Workaround    Use other browsers like Firefox."""
"CONFSERVER-54154","Bug","User - Mentions",2,"Context path changes causes @mention avatar thumbnail to not display","""h3. Summary  If the context path is updated, the avatar thumbnail image does not display when using an @mention.  Testing revealed that this applied to any user whose profile picture was created before the context path change.  Problem does not occur for user profile pictures uploaded after the context path change.    h3. Environment  Confluence version 6.4.1   Not dependent on OS, DB or browser    h3. Steps to Reproduce  # Create a user profile and add a avatar picture.  # Stop Confluence.  # Change the context path value within the server.xml and confluence.cfg.xml files.  # Start Confluence  # Create a page and add an @mention.    h3. Expected Results  The user should be found and their avatar thumbnail image should appear when being @mentioned.     h3. Actual Results  While the user should be found, no avatar thumbnail image displays when being @mentioned.     h3.Workaround  # Locate every record in the content table with a title of 'user-avatar' created prior to the change in context path:    # For every record returned, delete the corresponding records in the contentproperties table based on contentid.  # Likewise, delete the corresponding records in the imagedetails table based on contentid from content table equalling the attachmentid in imagedetails table.  # If there are entries in the content table with a value in the prevver column, delete these records.   # Delete every 'user-avatar' record from the content table.  # In Confluence, rebuild the Content Index.  # For each user included in the delete statements above, readd their profile picture.  # When you do a subsequent @mention, you will need to type in a minimum of 3 characters before the profile thumbnail appears.    While this works, this will not be practical for larger user populations."""
"CONFSERVER-54169","Bug","Universal Plugin Manager / Manage apps",2,"Can't update system/bundled plugins when JVM flag ""-Djsse.enableSNIExtension=false"" is used","""h5. Summary   * JVM """"-Djsse.enableSNIExtension=false"""" parameter was added in setenv.shas a workaround to [error 'handshake alert: unrecognized_name' when setting up application links after upgrading Confluence|https://confluence.atlassian.com/confkb/error-handshake-alert-unrecognized_name-when-setting-up-application-links-after-upgrading-confluence-753895174.html]. Permanent resolution can't be applied because of apache/oracle limitations   * Then it is not possible to update any system or user plugins via Confluence Administration -> Manage add-ons.  This was working fine till September, when changes happened on Marketplace side    h3. Instance Details   * Problem reproducible on instances 5.10, 6.4.3, 6.1, databases psotgreSQL 9.4 and H2, bundled Java 8    h3. How to Replicate   * Install Confluence 6.4.3 (linux 64 bit) using default installation parameters and H2 database.   * Download directly from marketplace any 3rd party plugin .jar file (use one or two versions below the most recent so that update option is possible)   * Upload plugin manually by going to Confluence Administration -> manage add ons -> Upload add-on   * Shutdown Confluence. Add following parameter to setenv.sh file       * Start Confluence, go to COnfluence Administration -> Manage add-ons. Try to update 3rd party plugin installed previously.  Update will not be possible, following message should be visible in application logs         h3. Workaround   * Remove the JVM Parameter """"-Djsse.enableSNIExtension=false""""   * Add the correct ServerName/ServerAlias(ses) to the specific hosts in the Apache configuration as this article describes: [https://community.qualys.com/thread/13532]"""
"CONFSERVER-54166","Bug","Core - Workbox",3,"Clicking 'More' in Workbox doesn't do anything when instance has a large number of notifications","""When clicking 'More' in Workbox, you see the spinner and then it disappears, without showing older notifications.    In the console the request has the path '/rest/mywork/latest/notification/nested?before=10000000&limit=30' and the reponse is an empty list. When doing a rest request for notifications without the 'before' parameter (i.e. '/rest/mywork/latest/notification/nested?limit=30'), it looks like all my recent notifications have ids > 10000000."""
"CONFSERVER-54194","Bug","Apps - Team Calendar",3,"Deleting Calendar from Team Calendar with more than 1000 events cause Oracle ORA-01795","""h3. Summary  Calendar in Team Calendar cannot be removed due to more than 1000 events.     h3. Environment  * Oracle Database only    h3. Steps to Reproduce  # Configure latest Confluence on Oracle with Team Calendars  # Create calendar  # Create more than 1000 events for that calendar  # Remove Calander     h3. Expected Results  Deleting calendar removes the calendar    h3. Actual Results    The below exception is thrown in the atlassian-confluence.log file:       h3. Notes  This bug is specifically only for Team Calander that have more than 1000 events and using Oracle database.    h3. Diagnostic Step  Please use the SQL below to see if this bug is applicable to you before proceeding to the workaround step  {code:title=SQL query for all events in specific calander}  select * from """"AO_950DC3_TC_SUBCALS"""" tc,""""AO_950DC3_TC_EVENTS"""" te where   dBMS_LOB.INSTR( tc.name, '<Calendar >')>0   and te.""""SUB_CALENDAR_ID"""" = tc.""""ID""""    select tc.""""NAME"""",te.""""SUB_CALENDAR_ID""""  from """"AO_950DC3_TC_SUBCALS"""" tc,""""AO_950DC3_TC_EVENTS"""" te where   dBMS_LOB.INSTR( tc.name, '<Calender')>0   and te.""""SUB_CALENDAR_ID"""" = tc.""""ID""""    delete from """"AO_950DC3_TC_EVENTS"""" where """"SUB_CALENDAR_ID""""='<SUB_CALENDAR_ID>'  {code}  # Start Confluence  # Remove Calender  """
"CONFSERVER-54262","Bug","Search - Core",3,"Searching for users can use lots of memory resulting in long GC pauses  ","""Searching for users in different parts of the product such as @ mentioning users on pages, sharing pages, creating team calendar events, etc can cause memory to spike which results in longer memory cleanup cycles and results as long GC pauses.   """
"CONFSERVER-54310","Bug","Integrations - JIRA",1,"Confluence 'Create JIRA Report - Change log' doesn't load - regression","""h3. Summary    The JIRA 'Change log' Report creator in Confluence no longer works.    When attempting to create a report the screen the 'loading' icon is displayed indefinitely and the report never loads.    This worked in 6.4.1, and broke in 6.5.0  h3. Environment   * Confluence Version 6.5.0   * Jira 7.5.3    h3. Steps to Reproduce   # In confluence click on the '...' next to the 'Create' button in the top menu bar   # Select 'JIRA Report' and click 'next'   # Select 'Change Log' and click 'next'   # Select a Project from the drop down menu, leave other fields as default and click 'create'    h3. Expected Results   # The report is created and the page is loaded    h3. Actual Results   * The loading icon will be displayed indefinitely and nothing will happen, the report is not created   * The below exception is thrown in the logs       * Error showing in the Chrome browser Console:      !jira-report.png|thumbnail!    h3. Workaround 1    - Remove the current version of Blueprints that you have bundled with Confluence. Refer to the following guide to uninstall bundled plugins: [How to Remove Bundled or System Plugins|https://confluence.atlassian.com/confkb/how-to-remove-bundled-or-system-plugins-648544751.html]  - Manually install new version of confluence-software-blueprints version 4.1.1. We have found this to work with the JAR file taken from Confluence 6.6.10. [^confluence-software-blueprints-4.1.1.jar]. A guide on how to manually install is here: [Installing Marketplace apps|https://confluence.atlassian.com/upm/installing-add-ons-273875715.html#InstallingMarketplaceapps-Installingbyfileupload].    h3. Workaround 2    """"switch to advanced"""" prior to hitting """"create"""" works for some users   * The error will occur if *Automatically update issue status and summaries from Jira* is checked in the *Switched to Advance* settings    h3. Workaround 3    Manually create the page"""
"CONFSERVER-54328","Bug","Apps - Team Calendar",2,"Disabled user is still receiving mail notification for team calendar reminder","""Steps to replicate :  # Create a new user in Confluence  # Add an event to the calendar and ensure that you add the newly created user to the """"Who"""" text field  # Set the """"When"""" to 10 minutes from the current time  # Reminder set to 5 minutes before  # Disable the newly created user immediately after that  # Wait for about 5 minutes and the newly created user will receive a mail notification    *Workaround*  Change the user email address to another email address via the admin panel"""
"CONFSERVER-54962","Bug","Web Interface - AUI",2,"Wrong Edit button color in Preview mode","""h3. Steps   # Edit a page   # Hit Preview button    *What happened...*    The Edit button's colour seems very dark and not the same as the Preview button. It make the Edit button not like a button.    !wrong-edit-button-color-in-preview-mode.gif|width=500!   *What should have happened...*   The Edit's button colour should have been lighter (i.e. it should have looked like the Preview button)"""
"CONFSERVER-55236","Bug","Apps - Team Calendar",3,"404 broken link in email notification","""the link marked - [Team Collaboration Software|http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=email-footer]    that points to - [http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=email-footer]    is broken (404)    see attached.     """
"CONFSERVER-54778","Bug","Macros - Other Macros",3,"Can not edit User Macros after upgrading Confluence 6.6.0(User Macros broken after upgrading)","""h3. Summary    Confluence is breaking User Macros after upgrading to the 6.6.0 version. It is breaking the edition of the macro to be more specific, so if you create a macro and you want to edit it, the editing screen will hang.    h3. Steps to Reproduce  # Install Confluence 6.3.3 or 6.5.0.  #* Reproduced in both environments.  # Create a User Macro with the following configuration:  #*  [^pestatus - macro code.txt] .  #*  !pestatus - Edit User Macro.png|thumbnail!   # Go to any page and insert the macro.  # Edit the macro and switch its Status values just to see that it is working.  # Save the page.  # Upgrade Confluence to the 6.6.0 version.  # Try to edit the macro again    h3. Expected Results  User will be able to edit the macro.  h3. Actual Results  The editor screen hangs and the Console of Google Chrome will throw the following error:      !screen_hanging.png|thumbnail!   h3. Notes      - User won't be able to insert any User Macro until this problem is fixed.  - Simple users macros from https://confluence.atlassian.com/doc/writing-user-macros-4485.html are not affected  - Editing the macro will let it working again temporarily. After some time, it will break again.  - Broken macros affected had the {{type=enum}}. Maybe that property is related to bug.    h3.Workaround  """
"CONFSERVER-54805","Bug","Page - Export / Import",2,"Page and space with attachment failed to Export to PDF for Confluence","""h3. Summary    Page with attachment failed to Export to PDF for Confluence hosted in Windows/Linux as well as space export.    Confluence 6.6.1 hosted in Windows/Linux will have issue exporting a page/space into PDF if there is an attachment in the page.  h3. Steps to Reproduce   # Install Confluence 6.6.1 on a Windows/Linux machine   # Create a page and include an attachment to the page (I tested using drag and drop a JPG file)   # Export the Page to PDF or export the space    h3. Expected Results    Page/Space can be exported as expected  h3. Actual Results    Confluence will hit into *System Error* page and show the stacktrace in the page   !SystemError.png|thumbnail!    error below is thrown in the {{atlassian-confluence.log}}:    h3. Note   * Tested on OS:   ** Windows 7 (x)   ** Windows 10 (x)   ** Linux (x)   * Tested with attachment file type:   ** JPG (x)   ** PDF (x)   ** TXT (x)   ** XLSX (x)   ** RAR (x)   * Confluence 6.6.1 installed on Linux *does not* encounter this issue.   * This is likely to be caused by the extra code added in *confluence-flyingpdf-plugin-4.1.3.jar* as downgrading to *confluence-flyingpdf-plugin-4.1.2.jar* then the export with attachment will work.    h3. Workaround    Remove the *confluence-flyingpdf-plugin-4.1.3.jar* located in {{<Confluence-Installation>/confluence/WEB-INF/atlassian-bundled-plugins}} and replace it with *confluence-flyingpdf-plugin-4.1.4.jar* from [Atlassian Repository|https://maven.atlassian.com/content/repositories/atlassian-public/com/atlassian/confluence/extra/confluence-flyingpdf-plugin/4.1.4/confluence-flyingpdf-plugin-4.1.4.jar]    (!) Please take a backup of the original bundled plugin"""
"CONFSERVER-54961","Bug","Web Interface - AUI",2,"Page tree padding looks too tight","""After rebuild the page tree, the 5px padding between rows has disappeared. We need to add it back in.    Keep in mind, the page tree has some weird dependencies between:   * Open sidebar page tree   * Closed sidebar page tree   * Page tree macro    These should all be tested individually."""
"CONFSERVER-54830","Bug","Apps - Team Calendar",3,"Team Calendar event notification not sent due to missing user profile picture.","""h3. Summary    Within Team Calendar 5.5.0, if a calendar event is updated, the users referenced by that event will not receive an email notification if at least one of them doesn't have a profile picture set.  h3. Environment   * Confluence 6.3.1   * Team Calendar 5.5.0    h3. Steps to Reproduce   # Create a user with no profile picture set.   # Create a calendar.   # Create an event or update an existing event and add the above user to the event.    h3. Expected Results    An email notification should be generated and sent to all users on a calendar event after it is created or updated.  h3. Actual Results    No email notification is sent.  h3. Notes    Within the logs, the following error message appears:    Note where the NullPointerException is occurring within createDefaultProfilePictureDataHandler method.  h3. Workaround    Uninstall Team Calendar 5.5.0 and fall back to version 5.3.20."""
"CONFSERVER-54888","Bug","Themes / Theming",5,"Cannot change favicon","""h3. Summary    In Confluence 6.7.0, when attempting to change favicon to anything other than the Confluence logo, the image is uploaded but does not change in the browser tab. After upload, the favicon setting in Confluence shows the uploaded image, but the tab still only displays the Confluence logo.    h3. Steps to Reproduce    # Navigate to *Site Logo and Favicon* in the Admin Console  # Select """"Choose File"""" from *Upload from File*    h3. Expected Results    Icon in the browser changes to the image you uploaded    h3. Actual Results    The Icon in the browser tab never changes from the Confluence Logo  !https://images.g2crowd.com/uploads/product/image/large_detail/large_detail_1505148164/confluence.png|width=15!    h3. Notes    Tested in Confluence 6.6 and the issue does not exist   Site Logo and title still functional    h3. Workaround    # Shutdown Confluence  # Update {{<confluence_install>/confluence/images/brand-images/favicons/fav-confluence.ico}} with your custom favicon.ico  # Update {{<confluence_install>/confluence/johnson/fav-confluence.ico}} with your custom favicon.ico  # Delete the contents of {{<confluence_install>/work/*}} (do not remove the folder)  # Delete the contents of {{<confluence_install>/temp/*}} (do not remove the folder)  # Startup Confluence and the {{favicon.ico}} should show on the Browser tab  """
"CONFSERVER-54978","Bug","Themes / Theming",2,"IE11 will not render .png images when Image Effect is applied and nosniff enabled","""h3. Summary    When adding *.png* image and applying image effect on to it, image generated from thumber will incorrectly return with mime type image/jpeg  As a result, when using in combination with X-Content-Type-Options: *nosniff* set at Apache frontend and IE11 image will not be rendered  h3. Environment   * Microsoft Internet Explorer 11    h3. Steps to Reproduce   # Inserted an image *screenshot.png* into a Confluence page and embed it   # Add an ImageEffect to the picture   # The generated image is screenshot.jpg   # Analyze the screenshot.jpg with Apache Tika or [HAR|https://confluence.atlassian.com/display/KB/Generating+HAR+files+and+Analysing+Web+Requests] file    The following image properties are returned:    !image-info.png|thumbnail!  h3. Expected Results    The generated image should remain .png and content-type of the image with effects is image/png  h3. Actual Results    The content-type of the image with effects is image/jpeg    !response-headers.png|thumbnail!    As a result, if X-Content-Type-Options: *nosniff *set at Apache frontend, then Image will not be rendered by IE11  h3. Workaround    Issue is not observed by Other Browsers or [disable nosniff|https://geekflare.com/secure-mime-types-in-apache-nginx-with-x-content-type-options/]."""
"CONFSERVER-55035","Bug","Platform - Application Links",1,"The bundled Atlassian Application Links plugin had various XSS issues - CVE-2018-5227","""Application Links needs to be updated see https://ecosystem.atlassian.net/browse/APL-1356. The affected version(s) of Application Links is/are before version 5.4.4."""
"CONFSERVER-55070","Bug","Content - Page|Themes / Theming",3,"When a draft of a page is saved/published with Collaborative Editing turned off, the page is added to the root of the space, not the page tree where it was intended.","""h3. Summary    When a draft of a page is saved with Collaborative Editing turned off, the page is added to the root of the space, not the page tree where it was intended.     h3. Environment  * Can be reproduced in 6.7.0, 6.7.1  * Cannot be reproduced in earlier versions than 6.0 (tested in 5.9.3 and 5.10.x)    h3. Steps to Reproduce  # Turn Collaborative Editing off  # Go to a space with existing page trees [Ex. SpaceTest1]  # Go to an existing parent page tree with a child page(s) [In this example, call it PageTree1]  # Click the """"..."""" next to the """"Create"""" button on the top menu bar  # Select a blank page and clicking the """"SpaceTest1"""" space in the drop down menu  # Type in random text """"abc12345678910"""" and clicked close  # Click on your avatar and navigate to """"Drafts""""  # You should see it listed in """"Drafts"""" and click it to continue editing   # Make another change, like adding the string """"12345678910abc""""  # Click """"Save"""" to publish your change  # This page was intended to be a child of the """"PageTree1"""" page tree, but instead is saved under the """"SpaceTest1"""" space    h3. Expected Results    The page was expected to be saved under the page tree selected, not the root of the space    h3. Actual Results  An intended child page is created as a parent page under the Space     h3. Notes  This only occurs when Collaborative editing is OFF. Functionality performs as intended when Collaborative Editing is ON.    h3.Workaround  Manually move the child page under the parent page or turn Collaborative Editing on    """
"CONFSERVER-55093","Bug","Editor - Page / Comment Editor",3,"Cmd + S doesn't publish the page if used inside title","""h3. Summary:  When editing/creating new pages, providing the title and then immediate clicking on {{cmd + s}} shortcut, Confluence does not publish the page anymore    h3. Notes:  * 6.6.0 : When entered title only - Saves as page; when entered title and tab to the page editor - Saves the page  * 6.7.0 : When entered title only - Saves as HTML; when entered title and tab to the page editor - Saves the page  * 6.7.1 : When entered title only - Saves as HTML; when entered title and tab to the page editor - Saves the page"""
"CONFSERVER-55134","Bug","Core - Workbox",5,"Workbox Notification will timeout on first attempt, and shows blank page and System Error message","""h3. Summary  [Workbox Notification|https://confluence.atlassian.com/doc/workbox-notifications-284365963.html] does not work and shows empty page on first attempt following a Confluence restart. It will work and able to retrieve information on the next attempts/ page refresh.    h3. Steps to Reproduce  # On a fresh installation of Confluence,   # Click on the Workbox Notification icon on the top right corner    h3. Expected Results  The workbox notification loads correctly    h3. Actual Results  # The workbox notification shows blank page:   !screenshot-2.png|thumbnail!   # After a while, at times, a System Error appears in the page after a page refresh   !screenshot-1.png|thumbnail!     The following appears in the atlassian-confluence.log when the page is blank  {code}  2018-03-07 23:20:57,928 ERROR [http-nio-8090-exec-5] [atlassian.confluence.event.ConfluenceEventDispatcher] run There was an exception thrown trying to dispatch event [com.atlassian.mywork.host.event.BeforeCountNewNotificationsEvent@31bba1bf] from the invoker [com.atlassian.confluence.event.ConfluenceListenerHandlersConfiguration$TimingListenerHandler$1$1@7794c789]   -- referer: http://localhost:8090/dashboard.action | url: /rest/mywork/latest/status/notification/count | traceId: 2877b0225ae534da | userName: admin  java.lang.RuntimeException: service proxy has been destroyed. Listener: com.atlassian.mywork.host.service.ClientServiceImpl event: com.atlassian.mywork.host.event.BeforeCountNewNotificationsEvent  {code}    Eventually, it will timeout with the following:  {code}  2018-03-07 23:22:44,209 ERROR [http-nio-8090-exec-5] [[Standalone].[localhost].[/].[servlet-module-container-servlet]] log Servlet.service() for servlet [servlet-module-container-servlet] in context with path [] threw exception  java.lang.RuntimeException: java.util.concurrent.TimeoutException   at com.google.common.base.Throwables.propagate(Throwables.java:160)  {code}    The following appears in the log when seeing the System Error:         h3.Workaround  Refresh the page a couple of times    h3. Notes  The issue happens to every user, during the first time accessing Workbox Notification following a restart.    Other than restarting Confluence, this can be easily replicable by accessing Workbox Notification for the first time following *enabling a previously disabled* Workbox plugins::  # Workbox - Common Plugin  # Workbox - Confluence Provider Plugin  # Workbox - Host Plugin"""
"CONFSERVER-55142","Bug","Apps - Confluence Questions",5,"Images in Questions for Confluence don't work","""h2. *Summary*    Images attached to initial Confluence Questions are not displayed _in another Browser session_.       h2. *Testing Environment*    Confluence 6.6.1 with Confluence Question plugin v2.5.5    (Also tested this Confluence v6.3.1 and 6.7.2)   (Also tested this with Collaborative Editing disabled which does not help)      h2. *Steps to Reproduce*   # Create a new Question by clicking on """"*Ask question*""""   # Attach an image to the question.   # Add topic and Save.    # Open the question in a fresh browser, like Safari's _Private Window._   # Open the question again, the image will not be displayed.       h2. *Expected Result*    The image show up correctly as the user uploaded.    !image attached.png|thumbnail!       h2. *Actual Result*    The image doesn't appear and the browser shows a resource not found error.    !image bug.png|thumbnail!      h2. *Resolution:*    Upgrade to Confluence Questions 2.6.6 or newer  h2. *Diagnosis 1*:    1. When clicking on """"Ask Question"""", a row in CONTENT is inserted immediately with the following content (e.g. CONTENTID 3407882)    2. Once the attachment is uploaded into the Question and the Question is Saved, the above row is eventually updated and deleted and a new row in CONTENT is created with a *brand new contentid* (e.g. 3407884)    3. However, in BODYCONTENT, the image attachment in the body is still pointing to the very original *PAGE ID 3407882* instead of the new PAGE ID (i.e. 3407884):    h2. *Diagnosis 2*:    1. Check the URL for the Confluence Question, e.g.:    2. Right click on the broken image of the initial Confluence Question post and the ID after the attachments does not match to the above Question URL, e.g. image is linking to *3407893* and not the above *3407895*:    h2. *Workaround 1 - for New Questions*    The following procedure is not a scalable workaround, but works.   # Create a new question and save it _without_ any images in it.   # Browse to that question again and *edit* it.   # Upload the images required in the question and *save* it.    h2. *Workaround 2 - for Existing Questions*   # Open the _faulty_ Question.   # *Right Click* on the broken image of the Question and *Open Image in a New Tab*.   !right-click.png|thumbnail!   # Match the URL of the _Question_ and the _New Tab_. Update the *number* after attachments in the _New Tab_ to be the same as the the number after _questions_ and press Enter.   !match URL.png|thumbnail!   # The Image will be displayed.   # Download this image.   # *Edit* the faulty Question and re-attach the image."""
"CONFSERVER-55165","Bug","Apps - Team Calendar",3,"Can't edit recurring events on Team Calendars","""h3. Summary    You can't edit events in case they are recurring events.    h3. Environment    * Confluence 6.7.2   * Team Calendars 5.5.4    h3. Steps to Reproduce    # Install Team Calendars.  # Create an event.  # Select """"All day event"""".  # On the repeat field, choose """"Monthly"""" and then """"Same date"""".  # Edit the event's title or date     h3. Expected Results    The event's settings will be changed    h3. Actual Results  Nothing happens    h3.Workaround  No workarounds so far  """
"CONFSERVER-55157","Bug","Apps - Team Calendar|Core - Email",5,"Images in Team Calendar notification e-mails not rendering in Outlook and Gmail Clients","""h3. Summary  The new SVG images used in Confluence 6.7.x are not rendered by Gmail nor Outlook, which results in the Team Calendars notifications having unrendered images.    h3. Environment  * Running Confluence 6.7.x  * Using:  ** Gmail  ** Outlook  ** Microsoft Exchange Online    h3. Steps to Reproduce  # Configure Confluence with E-mail notifications  # Have a user account watch a calendar  # Take an action on the calendar that would update the user via email    h3. Expected Results  The e-mail renders without issue    h3. Actual Results  The e-mail doesn't render the images properly    *Gmail*  !confluence_670_gmail.png|thumbnail!      *Microsoft Outlook 2010*  !confluence_670_outlook_2010.png|thumbnail!     *Microsoft Exchange Online*  !confluence_671_microsoft_exchange_online.png|thumbnail!    h3. Notes  * [Gmail Restrictions|https://developers.google.com/gmail/add-ons/guides/restrictions]    h3.Workaround  Use a supported e-mail client. Issue does not occur in Apple Mail nor Office365  """
"CONFSERVER-55227","Bug","Translations",3,"Many translations to Chinese are garbled","""h2. Summary of Issue    Many translations in the latest language pack for Chinese are garbled.  h2. Environment    Confluence 6.8.0 with User Profile language set to Chinese.  h2. How to reproduce (and actual results)    Please note these are just four reported examples:   # Install Confluence 6.8.0   # Login to the Confluence   # Change the language setting to non-english. (In this example, to Chinese)   ** (1) Edit a page, click on emoticon and bottom tip text is garbled   ** (2) Insert the """"page index"""" macro and the total number of pages is garbled   ** (3) Edit the page, click on the Invite user to edit, the post hover box text is garbled   ** (4) Edit the page, click on the Invite user to edit, the email notification title is garbled   ** (5) When a user attempts to edit a page they do not have access to, they click on the *Request Access* link   *** The page owner is then sent an Email to approve the access   *** If the page owner's profile then clicks on the email, they are taken to the Confluence page and the tooltip under the Page Permissions page is garbled    !Emoticon_translation_issue.png|thumbnail!    !Page_index.png|thumbnail!    !Invite_user_to_page.png|thumbnail!    !Authorise_user.png|thumbnail!  h2. Expected Result    The text should be properly translated and not appear as garbled text.  h2. Notes   * This can potentially affect JIRA Core, Stash, Bitbucket as well since some translations are shared."""
"CONFSERVER-55237","Bug","Universal Plugin Manager / Manage apps",1,"The bundled Atlassian Universal Plugin Manager plugin had a XSS issue - CVE-2018-5229","""The version of the bundled Atlassian Universal Plugin Manager plugin had a cross site scripting vulnerability (XSS). See https://ecosystem.atlassian.net/browse/UPM-5871 for more details."""
"CONFSERVER-55267","Bug","Editor - Synchrony",5,"Links to internal pages and attachments are changed to a self-referential link after changing the context path or protocol (http/https) in the base URL","""This ticket is related to CONFSERVER-52060, but tracks a different set of symptoms.    * CONFSERVER-52060 tracks broken images, user mentions, and attachment macros. This set of symptoms have been fixed in Confluence 6.8.0  * CONFSERVER-55267 (this ticket) tracks broken *internal page links* and *attachment links* that specifically use the """"shown as links"""" option. This set of symptoms are not yet fixed in Confluence 6.8.0.  * CONFSERVER-52441 tracks broken *emoticons*, which describes editing pages changes macro into hard links.     In local testing, this requires Collaborative Editing to be *enabled* to reproduce.    h2. Steps to reproduce  # Install Confluence without any context path. Version 6.8.0 was used in this test. Make sure Collaborative Editing is enabled.  # Create a couple of test pages  # On one of the pages, create a link to another page.  # Drag an example attachment such as a zip file into the editor. Click it and choose to """"Show as link""""  # Save the page  {code:title=Your page storage format should end up with something similar to:}  <p><ac:link><ri:page ri:content-title=""""another page"""" /></ac:link></p>  <p><ac:link><ri:attachment ri:filename=""""myfile.zip"""" /></ac:link></p>    <p><ac:link /></p>  <p><ac:link /></p>  {code}    h2. Additional notes  Customers have also reported that this can occur when changing Base URL protocol rather than context path, for example http to https."""
"CONFSERVER-55261","Bug","Macros - Search",2,"Livesearch macro encodes some special characters in search results preview","""h5. Environment:  Confluence 6.7.0, PostgreSQL 9.5, Google Chrome  h5. Bug description  Livesearch macro certain characters in search previews  {code:title=Characters}  """"  '  &  <  >  {code}  {code:title=Livesearch preview results for each, respectively}  &quot;  &#39;  &amp;  &lt;  &gt;  {code}    in search results preview  h5. Steps to replicate  * Create new page with & character in page title for example """"test & test""""   !Screenshot_20180327_093436.png|thumbnail!   * Go to different page, add livesearch macro, save the page.   * Search for page with & character in pagename    h5. Expected results   Search results correctly encode & character in results preview      h5. Actual results  & is encoded as      !Screenshot_20180327_093414.png|thumbnail!   h5. Notes:  Issue is not visible when using main searchbox      """
"CONFSERVER-55278","Bug","Apps - Team Calendar",3,"private url for ical does not work properly on new subscribe dialog","""Private url does not show properly on new subscribe dialog    *The fix will be released in TC 6.0.0*      """
"CONFSERVER-55274","Bug","Server - Authentication",5,"OAuth - Service Provider - Session Remover Job is broken","""(!) This issue does not affect Data Center users. Confluence Data Center is currently able to run the clean-up job without problems.    h2. Issue Description  There's a scheduled job executed by Confluence job handler called {{Service Provider Session Remover}} accountable for removing expired OAuth tokens from {{BANDANA}} table. This job is not working properly, and expired tokens are not being cleared as expected. With enough expired tokens in the database, this can eventually lead to an {color:#ff0000}application crash{color} as the logic to handle tokens is negatively impacted by the number of expired and useless entries stored in the database.    h2. Steps to Reproduce  # Set up JIRA + Confluence applinked together through an OAuth relationship  # Add Confluence gadget feed to JIRA  # Create new JIRA Dashboard and add Confluence Page Gadget, do *not* """"Login and Approve""""  # Every time the Dashboard/Gadget is loaded, observe that a new {{com.atlassian.oauth.serviceprovider.ServiceProviderTokenStore.token.<somestring>}} row gets added in BANDANA table in Confluence, e.g.:  {code:title=bandanakey}  com.atlassian.oauth.serviceprovider.ServiceProviderTokenStore.token.5IWZaCCOpzibZTUboRNaJU5WmddxePSe  {code}  {code:title=bandanavalue}   <properties>     <property name=""""token"""" value=""""dqgAd6Oc9JU2G4ZuM6ec0PLmkIMf670w""""/>      <property name=""""creationTime"""" value=""""1521048328968""""/>      <property name=""""tokenSecret"""" value=""""ZAN3c7Yu6zEP8pUQVWB25e5odUrsRNbi""""/>        <property name=""""authorization"""" value=""""NONE""""/>      <property name=""""version"""" value=""""V_1_0_A""""/>     <property name=""""properties"""" value=""""      xoauth_app_url=http\://confluence.example.com/rest/gadgets/1.0/g/com.atlassian.confluence.plugins.gadgets\:confluence-page-gadget/gadgets/confluence-page-gadget.xml   """"/>      <property name=""""type"""" value=""""REQUEST""""/>        <property name=""""callback"""" value=""""http://jira.example.com/plugins/servlet/gadgets/oauth-callback""""/>      <property name=""""consumerKey"""" value=""""jira:2f5ae229-2135-43a8-bfd4-77f1cd14b3cc""""/>       <property name=""""timeToLive"""" value=""""600000""""/>     </properties>  {code}  # Load the JIRA Dashboard and Gadget several times and observe there are now several such entries in the BANDANA table.  # Leave Confluence running for 8 hours or more to ensure {{Service Provider Session Remover}} runs. It will not and you will be able to see evidence on logs that it has failed to execute. You should have an entry like the one below:  {code}  runJob Scheduled job CompatibilityPluginScheduler.JobRunnerKey.Service Provider Session Remover#CompatibilityPluginScheduler.JobId.Service Provider Session Remover completed unsuccessfully with response JobRunnerResponse[runOutcome=ABORTED,message='Job has unexpected run mode RUN_LOCALLY'].  {code}    h2. Expected Behavior  The {{Service Provider Session Remover}} runs every 8 hours and clears out the OAuth tokens from BANDANA    h2. Actual Behavior  The {{Service Provider Session Remover}} attempts to run every 8 hours but is aborted. The {{scheduler_run_details}} table shows:  {code}     id    |                               job_id                                |       start_time        | duration | outcome |                 message                   ---------+---------------------------------------------------------------------+-------------------------+----------+---------+-----------------------------------------    428282 | CompatibilityPluginScheduler.JobId.Service Provider Session Remover | 2018-03-27 02:56:11.413 |        6 | A       | Job has unexpected run mode RUN_LOCALLY  {code}    h2. Technical details  The above means that if the dashboard is loaded 1000 times, there will be 1000 such entries in the database. These tokens are supposed to be cleared from {{BANDANA}} via the scheduled job {{Service Provider Session Remover}} which runs every 8 hours, however the job is currently broken.    As expired/unused tokens are not removed, instances will eventually hold a huge number of tokens in their database. Due to the logic used in the [OAuth Plugin|https://bitbucket.org/atlassian/atlassian-oauth] and documented in [OAUTH-321|https://ecosystem.atlassian.net/browse/OAUTH-321], as the number of tokens in the database grows, so does the complexity of the problem it needs to resolve. This is because when inserting a new token to the database, it will iterate through a list of existing tokens to validate each one of them before inserting a new one.    The intent of this logic is to validate duplicated entries as well as keep the list of usable tokens up to date, however, as the set of data ( n ) that the algorithm needs to resolve gets bigger, so does the complexity of the problem, which demands more computational resources to get resolved, making the algorithm an O (n²) [complexity class|http://bigocheatsheet.com/] one, leading to eventual outages depending on the instance usage and available resources.    h2. Symptoms  The Confluence instances that run into the performance/stability problems due to high number of stored OAuth tokens will observe one or more of the following symptoms:   * High CPU Usage.   * High Memory Usage.   * A huge number of entries in {{BANDANA}} table related to {{Service Provider}} tokens. This can be confirmed by running below query:  {code:sql}   select count (bandanaid) from bandana where BANDANAKEY like '%com.atlassian.oauth.serviceprovider.ServiceProviderTokenStore.token%';{code}   * Reports of long-running/stuck threads in Tomcat and Confluence logs for /plugins/servlet/oauth/request-token, e.g.:  {code}  14-Mar-2018 00:40:18.482 WARNING [ContainerBackgroundProcessor[StandardEngine[Standalone]]] org.apache.catalina.valves.StuckThreadDetectionValve.notifyStuckThreadDetected Thread """"http-nio-8101-exec-12"""" (id=232) has been active for 69,763 milliseconds (since 3/14/18 12:39 AM) to serve the same request for https://confluence.example.com/plugins/servlet/oauth/request-token and may be stuck (configured threshold for this StuckThreadDetectionValve is 60 seconds). There is/are 9 thread(s) in total that are monitored by this Valve and may be stuck.  {code}   * Long-running/stuck threads in thread dumps that mention {{com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore.put}} in the stack trace. Examples:  {code:java}  """"http-nio-8443-exec-52"""" #320 daemon prio=5 os_prio=0 tid=0x00007f027c12a800 nid=0x14f9 runnable [0x00007f0235fb5000]     java.lang.Thread.State: RUNNABLE   at org.hibernate.bytecode.internal.javassist.BulkAccessor.getPropertyValues(BulkAccessor.java:58)   at org.hibernate.bytecode.internal.javassist.AccessOptimizerAdapter.getPropertyValues(AccessOptimizerAdapter.java:55)   at org.hibernate.tuple.entity.PojoEntityTuplizer.getPropertyValuesWithOptimizer(PojoEntityTuplizer.java:234)   at org.hibernate.tuple.entity.PojoEntityTuplizer.getPropertyValues(PojoEntityTuplizer.java:212)  ...   at com.atlassian.confluence.setup.bandana.ConfluenceCachingBandanaPersister.retrieve(ConfluenceCachingBandanaPersister.java:78)   at com.atlassian.confluence.setup.bandana.ConfluenceCachingBandanaPersister.retrieve(ConfluenceCachingBandanaPersister.java:71)   at com.atlassian.bandana.DefaultBandanaManager.getValue(DefaultBandanaManager.java:32)   at com.atlassian.bandana.DefaultBandanaManager.getValue(DefaultBandanaManager.java:24)  ...   at com.atlassian.sal.confluence.pluginsettings.ConfluencePluginSettings.get(ConfluencePluginSettings.java:67)   at com.atlassian.oauth.shared.sal.HashingLongPropertyKeysPluginSettings.get(HashingLongPropertyKeysPluginSettings.java:25)   at com.atlassian.oauth.shared.sal.PrefixingPluginSettings.get(PrefixingPluginSettings.java:17)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings$IsValidTokenReference.apply(PluginSettingsServiceProviderTokenStore.java:417)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings$IsValidTokenReference.apply(PluginSettingsServiceProviderTokenStore.java:409)  ...   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.getTokenKeySet(PluginSettingsServiceProviderTokenStore.java:383)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.getTokenKeys(PluginSettingsServiceProviderTokenStore.java:320)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.addTokenKey(PluginSettingsServiceProviderTokenStore.java:328)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.put(PluginSettingsServiceProviderTokenStore.java:292)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore.put(PluginSettingsServiceProviderTokenStore.java:139)  ...   at com.atlassian.oauth.serviceprovider.internal.DelegatingTokenStoreImpl.put(DelegatingTokenStoreImpl.java:31)   at com.atlassian.oauth.serviceprovider.internal.servlet.RequestTokenServlet.doPostInTransaction(RequestTokenServlet.java:109)   at com.atlassian.oauth.serviceprovider.internal.servlet.TransactionalServlet$2.serve(TransactionalServlet.java:48)   at com.atlassian.oauth.serviceprovider.internal.servlet.TransactionalServlet$3.doInTransaction(TransactionalServlet.java:57)   at com.atlassian.oauth.serviceprovider.internal.servlet.TransactionalServlet$3.doInTransaction(TransactionalServlet.java:54)  ...  {code}  {code:java}  """"http-nio-8101-exec-297"""" #9009 daemon prio=5 os_prio=0 tid=0x00007fb9e851a000 nid=0x8f1c runnable [0x00007fb9dc3bb000]     java.lang.Thread.State: RUNNABLE   at java.net.SocketInputStream.socketRead0(Native Method)   at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)   at java.net.SocketInputStream.read(SocketInputStream.java:170)   at java.net.SocketInputStream.read(SocketInputStream.java:141)   at oracle.net.ns.Packet.receive(Packet.java:311)   at oracle.net.ns.DataPacket.receive(DataPacket.java:105)   at oracle.net.ns.NetInputStream.getNextPacket(NetInputStream.java:305)   at oracle.net.ns.NetInputStream.read(NetInputStream.java:249)   at oracle.net.ns.NetInputStream.read(NetInputStream.java:171)   at oracle.net.ns.NetInputStream.read(NetInputStream.java:89)   at oracle.jdbc.driver.T4CSocketInputStreamWrapper.readNextPacket(T4CSocketInputStreamWrapper.java:123)   at oracle.jdbc.driver.T4CSocketInputStreamWrapper.read(T4CSocketInputStreamWrapper.java:79)   at oracle.jdbc.driver.T4CMAREngineStream.unmarshalUB1(T4CMAREngineStream.java:429)  ...   - locked <0x000000067f800000> (a oracle.jdbc.driver.T4CConnection)   at oracle.jdbc.driver.OraclePreparedStatementWrapper.executeUpdate(OraclePreparedStatementWrapper.java:1361)  ...   at com.atlassian.confluence.setup.bandana.ConfluenceCachingBandanaPersister.lambda$retrieve$0(ConfluenceCachingBandanaPersister.java:80)   at com.atlassian.confluence.setup.bandana.ConfluenceCachingBandanaPersister$$Lambda$354/101785611.get(Unknown Source)  ...   at com.atlassian.sal.confluence.pluginsettings.ConfluencePluginSettings.get(ConfluencePluginSettings.java:67)   at com.atlassian.oauth.shared.sal.HashingLongPropertyKeysPluginSettings.get(HashingLongPropertyKeysPluginSettings.java:25)   at com.atlassian.oauth.shared.sal.PrefixingPluginSettings.get(PrefixingPluginSettings.java:17)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.getTokenKeySet(PluginSettingsServiceProviderTokenStore.java:368)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.getConsumerTokens(PluginSettingsServiceProviderTokenStore.java:352)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.addConsumerToken(PluginSettingsServiceProviderTokenStore.java:360)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore$Settings.put(PluginSettingsServiceProviderTokenStore.java:293)   at com.atlassian.oauth.serviceprovider.sal.PluginSettingsServiceProviderTokenStore.put(PluginSettingsServiceProviderTokenStore.java:139)  ...  {code}    h2. Workaround  As a workaround, we need to clear tokens stored in {{BANDANA}} table manually, since the Scheduled Job is not doing it for us. To do that:   # Shutdown Confluence.   # Connect to your database client.   # {color:#FF0000}Take a backup{color} from your Confluence database in case we may need to revert it to its pre-delete statement state.   # Execute below query:  {code:sql}  delete from BANDANA where BANDANAKEY like 'com.atlassian.oauth.serviceprovider.ServiceProviderTokenStore.token%' and bandanavalue like '%value=""""REQUEST""""%'  {code}   # Restart the application.    After this is done, you should no longer observe the symptoms caused by this issue, however, users may be prompted to re-authenticate against applications that were relying on the OAuth tokens previously stored in the database once the clean-up is completed.    It is important to highlight that this workaround may need to be repeated from time to time until this bug is solved if symptoms re-occur. Instance administrators may want to setup a trigger in their database clients to execute this routine automatically based upon certain circumstances, like for example, {{BANDANA}} table going full of records if they intend to automate this task."""
"CONFSERVER-55287","Bug","Apps - Team Calendar",3,"Unable to Edit Single Event Instance in Repeating Events","""h3. Summary    Users are unable to save their changes to a Single Occurrence of a Repeating Event they've edited within Team Calendars. The page refreshes and the change is reverted back to its original configuration. This only appears to affect Events which are repeating; single, non-repeating events can be edited.  h3. Environment   * Confluence Server 6.4.1   * Team Calendars 5.5.4    h3. Steps to Reproduce   # On a Team Calendar, Create an event which has a repeat   # Save Event   # Edit one of the Events (either change it's title, date/time, Who, etc); ensure """"Edit this instance only"""" is checked   # Save Changes to event    h3. Expected Results    The Single Event is updated with the new information  h3. Actual Results    Calendar refreshes and change does not exist:  Confluence Logs:      h3. Resolution    Upgrade to Team Calendars -version 6.0.12 or above-, which contains a fix for this issue.    (i) Some customers report the issue persists even after upgrading to the fixed version (such as 6.0.17). Please watch this ticket to receive the latest updates.    h3. Notes    Appears to be related to: CONFCLOUD-55639    h3. Workaround    1. Delete the Individual Calendar Event that needs to be Edited and create a new Event with the intended changes.  2. Exporting the .ical and import it back to Confluence did the trick """
"CONFSERVER-55328","Bug","Apps - Confluence Questions",3,"The bundled atlassian-http library had a content spoofing issue - CVE-2017-18103","""The version of the bundled atlassian-http library was vulnerable to content-spoofing. See https://jira.atlassian.com/browse/HTTP-3 for more details."""
"CONFSERVER-55355","Bug","Translations",1,"""Child pages"" option translation","""h3. Problem    Polish translation of """"Child Pages"""" has been translated into: """"Strony dla dzieci"""" - that literally means """"Pages for children"""".    See the screenshot below:    !image-2018-04-13-17-05-37-165.png|width=214,height=329!  h3. Current value    """"Strony dla dzieci""""  h3. Expected value    """"Podstrony""""?  h3. Steps to reproduce   * Set language to polish   * Go to space > any page   * Click """"Konfiguracja sidebar"""" (Configure sidebar)    h3. Workarounds    Not found."""
"CONFSERVER-55422","Bug","Apps - Team Calendar",3,"Date selection arrows not visible with Team Calendars 6.0.0","""h3. Summary    With the latest update 6.0.0. of Team Calendar, arrows for changing the date disappeared.  h3. Environment    Team Calendar 6.0.0.   Confluence 6.3.4 or 6.6.4  h3. Steps to Reproduce   # Install Team Calendar 6.0.0   # Open Calendar page    h3. Expected Results    Arrows (left and right) for changing date/month will be visible.  h3. Actual Results    Arrows will be gone.   !image_arrows.png|thumbnail!  h3. Resolution    Upgrade to Team Calendars 6.0.12 or newer, which contains a fix for this issue.  h3. Notes    Latest Confluence 6.8.1 is not affected.  h3. Workaround    If possible upgrade to latest version of Confluence."""
"CONFSERVER-55506","Bug","Apps - Team Calendar",5,"Deleting repeating Events in Team Calendar causes duplicates in database and java.lang.OutOfMemoryError","""h3. Summary    Deleting Events in Team Calendar that are part of a repeating Event cause duplicates in the database, which causes performance issues and {{java.lang.OutOfMemoryError}} when viewing Team Calendars as the duplicates are loaded back into memory when re-loading the Calendar.    !outofmemory.png|thumbnail!  h3. Environment   * Confluence 6.9.0   * Team Calendar 6.0.0 or 5.5.4    h3. Steps to Reproduce    This is quite tricky to reproduce with clear, concise steps. It may differ but in general   # In Team Calendars, create an all day Event that repeats every day and never ends   # Delete one event, at least a week after the first one   # Check the Team Calendar Exclusion table for duplicates (this is for Postgres, adjust as necessary)  {code:sql}  select """"EXCLUSION"""", count(*) from """"AO_950DC3_TC_EVENTS_EXCL"""" group by """"EXCLUSION"""";  {code}  There should be one event listed, the deleted one     # Click on a date before the deleted event, and select *All Future Events*   # Check the Team Calendar Exclusion table for all duplicates (this is for Postgres, adjust as necessary)  {code:sql}  select """"EXCLUSION"""", count(*) from """"AO_950DC3_TC_EVENTS_EXCL"""" group by """"EXCLUSION"""";  {code}  The Events are not removed.    h3. Diagnosis  Run the following query to see if you may be affected by this issue (this is for Postgres, adjust as necessary):  {code}select """"ALL_DAY"""", """"EVENT_ID"""", """"EXCLUSION"""", count(*) from """"AO_950DC3_TC_EVENTS_EXCL"""" group by """"ALL_DAY"""", """"EVENT_ID"""", """"EXCLUSION"""" having count(*) > 1;{code}  If there are rows returned, it's possible you are experiencing this issue, especially if the count for any row is high.    h3. Expected Results    There should be only be two rows in {{AO_950DC3_TC_EVENTS_EXCL}} and the Events should be removed.  h3. Actual Results    The below exception is thrown in the {{atlassian-confluence.log}} file:  {noformat:title=atlassian-confluence.log}  2018-05-09 16:55:31,339 ERROR [http-nio-8090-exec-7] [common.error.jersey.ThrowableExceptionMapper] toResponse Uncaught exception thrown by REST service: Java heap space   -- referer: http://confluence.mycompany.com:8090/calendar/mycalendar.action | url: /rest/calendar-services/1.0/calendar/events.json | traceId: b85eaf70252053ab | userName: admin  java.lang.OutOfMemoryError: Java heap space  {noformat}  h3. Resolution    Upgrade to Team Calendars 6.0.12 which contains a fix for this issue.  h3. Notes    Reviewing the heap dump from the {{java.lang.OutOfMemory}} error we can see that there are a few very large threads loaded with duplicates of the data, for example  ||object||cause||size||  |com.mysql.jdbc.JDBC42ResultSet|AO_950DC3_TC_EVENTS_EXCL|946M|  |http-nio-8090-exec-2|/rest/calendar-services/1.0/calendar/events.json|716M|    The {{com.mysql.jdbc.JDBC42ResultSet}} is pulling all the data from {{AO_950DC3_TC_EVENTS_EXCL}}. {{http-nio-8090-exec-2}} is the associated user thread.    The URL in the HAR fill shows it as   * [https://confluence.mycompany.com/rest/calendar-services/1.0/calendar/events.json?subCalendarId=02a75ad8-f7d5-4365-ba6d-02f437279e94&userTimeZoneId=Sydney%2FAustralia&start=2018-04-28T00%3A00%3A00Z&end=2018-08-08T00%3A00%3A00Z&_=1525628684224]    And this returns all the data, or generates the {{java.lang.OutOfMemoryError}}.    The error is caused by this code  {code:java|title=com.atlassian.confluence.extra.calendar3.DefaultCalendarManager#excludeEvent}              excludeRecurrence(                      baseEvent,                      !(baseEvent.getStartDate().getDate() instanceof net.fortuna.ical4j.model.DateTime || baseEvent.getEndDate().getDate() instanceof net.fortuna.ical4j.model.DateTime)                              ? excludeDate.withZoneRetainFields(DateTimeZone.forID(srcSubCalendar.getTimeZoneId()))                              : excludeDate.withZone(DateTimeZone.forID(srcSubCalendar.getTimeZoneId()))              );                calendarDataStore.updateEvent(srcSubCalendar, baseEvent);  {code}  h3. Workaround    The only option is to delete the duplicates in the {{AO_950DC3_TC_EVENTS_EXCL}} table and informing users to not delete *All Future Events*.  {panel:title=IMPORTANT|borderStyle=dashed|borderColor=#cccccc|titleBGColor=#f7d6c1|bgColor=#ffffce}  (!) Always back up your data before performing any modifications to the database. If possible, test any alter, insert, update, or delete SQL commands on a staging server first.  {panel}  h4. MySQL    You can remove the duplicates by adding then removing this index  {code:sql|title=MySQL 5.6 and below}  ALTER IGNORE TABLE AO_950DC3_TC_EVENTS_EXCL ADD UNIQUE INDEX AO_950DC3_TC_EVENTS_EXCL_TEMP_INDEX (ALL_DAY, EVENT_ID, EXCLUSION);  ALTER TABLE AO_950DC3_TC_EVENTS_EXCL DROP INDEX AO_950DC3_TC_EVENTS_EXCL_TEMP_INDEX;  {code}  {code:sql|title=MySQL 5.7 and above}  CREATE TABLE AO_950DC3_TC_EVENTS_EXCL_NEW LIKE AO_950DC3_TC_EVENTS_EXCL;  ALTER TABLE AO_950DC3_TC_EVENTS_EXCL_NEW ADD UNIQUE INDEX (EVENT_ID);  INSERT IGNORE INTO AO_950DC3_TC_EVENTS_EXCL_NEW SELECT * FROM AO_950DC3_TC_EVENTS_EXCL;  DROP TABLE AO_950DC3_TC_EVENTS_EXCL;  RENAME TABLE AO_950DC3_TC_EVENTS_EXCL_NEW TO AO_950DC3_TC_EVENTS_EXCL;  {code}  h4. PostgreSQL    Delete the duplicates with (this may take some time)  {code:sql|title=PostgreSQL}  delete from """"AO_950DC3_TC_EVENTS_EXCL"""" where """"ID"""" in (select """"ID"""" from (select """"ID"""", row_number() over (partition BY """"EXCLUSION"""" order by """"ID"""") from """"AO_950DC3_TC_EVENTS_EXCL"""") excl_table WHERE excl_table.row_number > 1);  {code}"""
"CONFSERVER-55571","Bug","Apps - Team Calendar",1,"Context path does not work for Team calendar subscription (CALDAV)","""h5.Steps to reproduce  # Install a new Confluence 6.8, with Team Calendar 6  # Configure Confluence with Context path (exp : http://localhost:6801/sixegg/)  # Create a new Calendar  # Subscribe the newly created Calendar with your phone by following this [document|https://confluence.atlassian.com/teamcal/subscribe-to-team-calendars-from-android-calendar-946631707.html] (CALDAV)      h5.Expected Results  We should be able to subcribe to our Team Calendar as per described in our document      h5.Actual Results  The context path is missing from the url:     !screenshot-1.png|thumbnail!       h5. Resolution    CalDav uses Confluence's root URL as it's well-known URL. If you've configured Confluence with a context path, for example www.yoursite.com/confluence, your calendar app will not be able to connect to your Team Calendars.     To resolve this, you will need to make some changes to your proxy configuration, to redirect the well-known URL to your URL (including the context path).  See [our documentation|https://confluence.atlassian.com/display/TEAMCAL/Subscribe+to+and+from+Team+Calendars#SubscribetoandfromTeamCalendars-contextpath] for more information.   """
"CONFSERVER-55592","Bug","Apps - Team Calendar",2,"Deleting a calendar event triggers ORA-01795","""h3. Summary  Creating an event and inviting over than 1000 users makes it impossible to remove the event    h3. Environment  Oracle Database    h3. Steps to reproduce  # Create an event  # Add more than 1000 invitees  # Save  # Try removing the event    h3. Expected results  The calendar event is removed    h3. Actual Restuls  The calendar event is not removed and Confluence throws an error.      h3. Workaround  -"""
"CONFSERVER-55662","Bug","Apps - Confluence Questions",3,"Images broken on Questions for non admin users","""h3. Environment  * Questions plugin version 2.6.6, 2.5.5, 2.5.4  h3. Steps to Reproduce  *Scenario 1*  # Create a question in space as Admin and add an image to it  # Access same question as an ordinary user who has permission to question and space, the image will be broken  (i) same contentID  * URL when admin create Question and add an image to it: display/TEST/questions/2654304/question-by-admin  * URL when user access question : display/TEST/questions/2654304/question-by-admin  * URL when you do right click on the broken image and open in a new tab: display/TEST/questions/2654304/question-by-admin    *Scenario 2*  # Create a question in space as an ordinary user and add an image to it  # Access this question using Admin account, the image will be broken  (i) notice at this scenario the id changes in URL and workaround 2 provided on this bug fixed the issue    h3. Expected Results    Image to be rendered correctly for all admin and users    h3. Actual Results  image broken:   * The request for the image without effect will return 404.  * The request for the image with effect will return 403.    h3. Workaround For Scenario 2 - for Existing Questions   # Open the _faulty_ Question.   # *Right Click* on the broken image of the Question and *Open Image in a New Tab*.   !right-click.png|thumbnail!   # Match the URL of the _Question_ and the _New Tab_. Update the *number* after attachments in the _New Tab_ to be the same as the the number after _questions_ and press Enter.   !match URL.png|thumbnail!   # The Image will be displayed.   # Download this image.   # *Edit* the faulty Question and re-attach the image.    h3. Notes  * These are two bug [CONFSERVER-55241|https://jira.atlassian.com/browse/CONFSERVER-55241] [CONFSERVER-55142|https://jira.atlassian.com/browse/CONFSERVER-55142] that related to broken images on questions but this is not exactly the same scenario as raised here.  """
"CONFSERVER-55745","Bug","Editor - Collaborative editing",5,"Collaborative Editing takes an unfeasible amount of time to enable if a high number of stale drafts exist on the DB","""h3. Summary    Collaborative Editing takes an unfeasible amount of time to enable if the database holds a high number of *stale drafts*.    h3. Environment  * Confluence 6+   * DC or Standalone  * Reproduced with 20k stale drafts    h3. Steps to Reproduce  # Start Confluence  # Start Synchrony  # Go to the Collaborative Editing management page  # Attempt to enable CE    h3. Expected Results    Collaborative Editing is enabled in a few seconds.    h3. Actual Results    The *Change Mode* popup keeps spinning and the task is not completed:   !changemode.png|thumbnail!    Depending on the number of Stale Drafts, this task can take hours to complete or even fail.    h3. Notes    If you take thread dumps while CE is being enabled, we can see that the *Remove Stale Drafts* task is ongoing. This class can be spotted on the threads:        So, the problem is caused by the inefficiency of the *removeStaleSharedDrafts* task.    h3. Log Sample  {code:borderStyle=solid}  ERROR [Long running task: EnableTask] [springframework.transaction.support.TransactionTemplate] rollbackOnException Application exception overridden by rollback exception   -- url: /rest/synchrony-interop/enable | referer: https://confluence.example.com/admin/confluence-collaborative-editor-plugin/configure.action | traceId: 3764f927fd378bc8 | userName: admin  java.lang.IllegalStateException: Session/EntityManager is closed   ...   at com.atlassian.confluence.pages.DefaultPageManager.removeStaleSharedDrafts(DefaultPageManager.java:764)   ...   at com.sun.proxy.$Proxy2201.removeStaleSharedDrafts(Unknown Source)   at com.atlassian.confluence.plugins.synchrony.tasks.EnableTask.execute(EnableTask.java:53)   at com.atlassian.confluence.plugins.synchrony.tasks.AbstractConfigLongRunningTask.runInternal(AbstractConfigLongRunningTask.java:65)   at com.atlassian.confluence.util.longrunning.ConfluenceAbstractLongRunningTask.run(ConfluenceAbstractLongRunningTask.java:26)   at com.atlassian.confluence.util.longrunning.ManagedTask.run(ManagedTask.java:52)  {code}    h3.Workaround    Follow the KB below in order to manually remove the staled drafts:    * [How to manually remove Stale Drafts from Confluence Database|https://confluence.atlassian.com/display/CONFKB/How+to+manually+remove+Stale+Drafts+from+Confluence+Database]"""
"CONFSERVER-58898","Bug","Translations",2,"Users get US English if their language preference is en-AU,en-GB,en-US","""This causes English users to get the wrong locale of English. In particular most US English users get UK English."""
"CONFSERVER-55754","Bug","Navigation - Space Directory",0,"Archived Space and page appears in quick nav","""h4. Summary/Expected Result  According to [Archive a Space|https://confluence.atlassian.com/confcloud/archive-a-space-724764817.html], If a space is archived, that space and it's contents won't appear on any dropdown menus, including the *Confluence quick navigation*, which drops down when you enter text in the search box.    h4. Actual Result  Pages from an archived space still appear in quick nav     h4. Steps to replicate  # Create space A  # Create space B  # Create page 'ABC' in space A  # Create page 'DEF' in space B  # Archive space B  # Search for 'ABC'  #* ABC now appears in quick nav  # Search for DEF (with the """"Search archived spaces"""" tag enabled)  #* DEF now appears in quick nav    h4. Note  This behavior is similar to [CONFSERVER-36344 - Archived Space and page appears in quick nav for members of the confluence-administrators group|https://jira.atlassian.com/browse/CONFSERVER-36344] but this also affects non-Confluence admin."""
"CONFSERVER-55858","Bug","Integrations - JIRA",1,"Korean translation is garbled in the current page right at the top in JIRA links",""" h4. Steps to reproduce  # Create JIRA Confluence application link  # Drag and drop at least 2 JIRA issues into a Confluence page  (i) translation is fine when there is only 1 JIRA issue link    h4. Observed behaviour  Korean translation is garbled in the current page right at the top in JIRA links  !JIRA issue links.png|thumbnail!    h4. Expected behaviour  JIRA 링크 """
"CONFSERVER-55918","Bug","Macros - Content by User",2,"XSS in User Macros, Macro Title and Icon URL","""h2. Summary    System Administrator is allowed to input JS/CSS in Macro Title and Icon URL in Macro Editor. The script input in the fields can be executed when user open """"Macro"""" selection window.  h2. How to reproduce   # Go to """"Edit User Macro""""  as Confluence Administrator.   !Screen Shot 2018-06-14 at 17.27.45.png|thumbnail!   # Input """"'""""><img src=x onerror=alert(1)>"""" in Macro Title field.   # Input """"http'""""><img src=x onerror=alert(3)>"""" in Icon URL field.   # Click save.   # Go to a certain page to edit.   # In edit UI, Select """"+"""" then select """"... Other Macros"""".   # Popups appear as alert(1) and alert(3) as set.   !Screen Shot 2018-06-14 at 17.31.31.png|thumbnail!    h2. Expected   * JS/CSS should not be allowed in Macro Title and Icon URL.     """
"CONFSERVER-55992","Bug","Server - Installer / Setup",2,"Can't restart Confluence after installing using windows installer and bundled JRE","""You can't start Confluence using {{start-confluence.bat}} if Java is not installed, and JAVA_HOME or JRE_HOME system environment variable is set correctly.     *Steps to reproduce:*    1. In Windows, check that Java is NOT installed, and that there's no env variable for either JAVA_HOME or JRE_HOME ({{echo %JAVA_HOME%}})  2. Install Confluence using the installer (don't install as a service)  3. Complete the setup wizard.   4. Stop Confluence.   5. Attempt to start confluence using {{start-confluence.bat}}    *Expected result:*    Confluence starts, using the bundled JRE.    *Actual result:*    Window closes immediatley, and Confluence does not start.    *Solution*    {panel}  Start Confluence using the options in Windows' Start menu, or run {{<install-directory>/startup-bundled-jre.bat}}.     The {{start-confluence.bat}} command is only used when you've installed Confluence manually, and are not using the bundled JRE{panel}  """
"CONFSERVER-55968","Bug","Server - Platform",2,"Notifications icon is missing","""h3. Summary  The Notifications/workbox icon is missing from fresh installs of Confluence 6.6.6    h3. Environment  * Confluence 6.6.6    h3. Steps to Reproduce  # Install Confluence 6.6    h3. Expected Results  The notification icon will be seen    h3. Actual Results  The notification icon is missing    !MissingIcon.png|thumbnail!     h3.Workaround     Add the following to the HEAD section in Custom HTML.    """
"CONFSERVER-55981","Bug","Core - Content REST APIs",2,"SSRF via REST API /plugins/servlet/gadgets/makeRequest","""Confluence installations have permissive whitelist that allows to fetch any URL using confluence like as the proxy.    Use GET request {{GET /plugins/servlet/gadgets/makeRequest?url=}}    Example:   to get Yandex start page or any resource you want.         *Update*    This issue was fixed in Confluence version 4.2.14. If you are experiencing this issue in a newer version of Confluence then please check the configuration of the in product whitelist as per [https://confluence.atlassian.com/doc/configuring-the-whitelist-381255821.html]."""
"CONFSERVER-56017","Bug","Integrations - JIRA",5,"Regression - JIRA Issues Macro fetching unnecessary fields from JIRA","""h2. Environment  * Confluence 6.6.x  * Jira 7.6.x    h2. Steps to Reproduce  # Create a Confluence page.  # Insert the Jira Issues macro.  # Insert a JQL filter and include *only specific custom fields* you require.  # Save the Confluence page.  # Reload the page.  # Review the Jira access log regarding the request called.    h2. Expected Behavior  Only specific custom fields as defined in the Jira issues macro will be searched.  {{field=allcustom}} parameter should be removed.    h2. Actual Behavior  All custom fields are being searched through and it causes the search to be extremely slow especially with instances comprised of large amount of custom fields. {{field=allcustom}} is apparent in the request URL e.g.      h2. Workaround  Exclude custom field as column to display under the _Display options_. Please find the differences in the search request URLs below using the same JQL query. Note the {{field=allcustom}} parameter is removed when custom field column is not configured in the display options.  h5. With Custom FIeld    h5. Without Custom Field  """
"CONFSERVER-56088","Bug","Macros - JIRA Macros",3,"JIRA Charts are not available for your version of JIRA. Upgrade to JIRA 6.1.1 or later to use this macro.","""h3. Summary    The error message """"{{JIRA Charts are not available for your version of JIRA. Upgrade to JIRA 6.1.1 or later to use this macro}}"""" can be presented to users already running versions of Jira higher than 6.1.1.    There appear to be multiple causes for this issue, but any connection failure to Jira appears to result in a value of {{-1}} being stored in cache for the remote Jira version number.    This causes the version check above to fail as {{-1}} is explicitly listed as an unsupported build version.    Additionally, the cache holds this value for 4 hours, so any subsequent requests for the next 4 hours will also fail with this error.  h3. Environment   * Confluence 6.3.2   * Jira 7.3.9    h3. Steps to Reproduce   # Create an AppLink between Confluence and Jira, both behind a Reverse Proxy   # Create a Jira Charts macro (JCM) in Confluence   # Shutdown Jira   # Restart Confluence (with Jira still down)   # Load the page with the JCM   # The Jira macro will fail to Preview   # Start Jira - other JIM macros will work except the Jira Chart will still fail    h3. Expected Results    The JCM should be displayed    h3. Actual Results    The below exception is thrown in the atlassian-confluence.log file:      h3. Validation    To inspect the *Jira build number* that Confluence has in it's cache, open up this URL to the Confluence Server:    * http://<confluence-base-url>/rest/jiraanywhere/1.0/servers    The JSON that returns will show the buildNumber for each of the Jira application link and the failing one should show -1 as the stored *buildNumber*. e.g.        h3. Notes    This issue often presents as a single occurrence that is resolved when the cache is cleared 4 hours later. In some cases, it can be persistent.  h3. Workaround    Re-indexing appears to correct this issue as in the process, the relevant cache is cleared in the process.    This may not be an acceptable workaround as if connectivity issues persist, the incorrect value will be stored in cache on the next version request.    Additionally, reindexing can be a time and resource expensive process that may rule this out as a fix in production."""
"CONFSERVER-57788","Bug","Content - History",2,"Anonymous user sees a broken image for user avatars. ","""See screenshot    Need to check if we can replicate this. Avatar of licensed user becomes broken (default avatar + anonymous user avatars are fine).    !Screen Shot 2018-05-01 at 5.33.36 pm.png|width=481,height=212!"""
"CONFSERVER-56118","Bug","Apps - Team Calendar",3,"NullPointerException when importing calendar from a different instance ","""h2. Environment   - Team Calendars 6.0.x    h2. Steps to reproduce   # Create a calendar;   # Add an event with a participant (in the _Who_ field);   # Export the calendar to .ics;   # Import the .ics file in another instance.    h2. Expected behavior    The calendar is imported with no errors.  h2. Actual behavior    NullPointerException appears in the importing window. Confluence logs show the following:    In spite of that, all the events are imported correctly with no participants - which is expected since the related user identifier (user_key) doesn't exist in the new instance.  ----  h2. Additional details    This bug seems to be caused by a user checker introduced in TC 6 to fix CONFSERVER-55887  h2. Workaround   # Uninstall Team Calendars 6.0.x in the Confluence instance   # Download Team Calendars version [5.3.20|https://marketplace.atlassian.com/download/apps/72307/version/2320]   # Navigate to the *Manage apps* Page   # Select *Upload Apps*   # Choose to upload the *team-calendars-5.3.20.obr* file that was just downloaded in step 2   # Create a new Team Calendar   # Import the ICS file into the newly created Team Calendar   # Once the import is successful, Update the Team calendar to TC 6.0.x (the latest version)"""
"CONFSERVER-56135","Bug","Macros - Widget Connector",2,"Vimeo videos don't play using the Widget Connector macro","""h3. Summary    Vimeo videos that are added with the Widget Connector macro do not play on any version of Confluence or in any platform or browser.  h3. Steps to Reproduce   # Create a page, add the Widget Connector Macro and insert a embed link to a Vimeo video.   # Save and update or publish the page    h3. Expected Results    The video should be embedded and display a thumbnail and the controls for the video.  h3. Actual Results    The screen remains blank.  h3. Notes    Looking at the browser console it's clear that the embed method used in the connector no longer works as the ([https://vimeo.com/moogaloop.swf]) file returns a 404.  h3. Workaround    _For Confluence 6.6+_, install Widget Connector 3.1.2: [^widgetconnector-3.1.2.jar]. {color:#FF0000}*This will not work in Confluence 6.5 and lower.*{color}    _For Confluence 6.5 and lower_:    There is no workaround in the macro itself, however a user macro can be created instead as an alternative using the below code which will use the iframe embed method instead.  """
"CONFSERVER-56148","Bug","Macros - Page Properties",3,"Intermittent NPE errors when using one or more Page Property Macro or any other macro","""h3. Summary    Seeing intermittent NPE and System Errors on a Page Properties Report Macro page. The page doesn't load and redirects to a 500 error page.   (!) It is also possible to encounter this bug through a different macro that uses the same code path and throws the same underlying error.  h3. Steps to Reproduce   # Download and restore [^PPM1space.xml.zip] to a Confluence instance   ** This space XML provide 900 pages that contains Page Properties Macro with label """"discussions""""   ** One of the page (titled """"1"""") contains an image that will be fetched by the Page Properties Report Macro   # Download and restore [^PPM2space.xml.zip]   ** This space contains a page with Page Properties Report Macro that fetches all pages in this site, labeled """"decisions""""   # Go to PPM2 > Page Properties Report Macro page    h3. Expected Results    All pages are fetched as expected  h3. Actual Results    Seeing Intermittent errors on this page, on each reload.    The errors initially doesn't give us more details as the JVM might me ommitting the stacktrace as part of    In order to inspect the full stack trace, we need to disable the JVM optimization by adding the following JVM argument    The full stacktrace looks like this:    The same behavior could cause the following stacktrace as well:    or    or    Watch the gif for more info:   * [^z0Qt3emhop.gif]    h3. Notes    The following points are observed:   # Issue is more pertinent when the PPRM filter is above 200   # Issue is *observed* when the PPRM is calling any sort of rich content (images, plugins, macros,etc)   # Issue is *not observed yet* with PPRM located in the same space as the pages with the PPM   # Issue is *not observed* when the image/rich content is removed   # Page Properties Report Caches are already on 50% utilization    h3. Cause    This issue is caused by a hibernate bug tracked here [https://hibernate.atlassian.net/browse/HHH-7867]. Some work has been done to alleviate and fix a part of this which can be found here [https://hibernate.atlassian.net/browse/HHH-10562].  h3. Workaround    There is nothing much we can do on our side until this bug is fixed on hibernate side. However, some users were able to avoid this by reducing the amount of Page Properties Macro fetched to 50 or below."""
"CONFSERVER-56186","Bug","Server - Installer / Setup",3,"Confluence doesn't get installed as a service even when the installer is run as root in Ubuntu","""h2. *Summary*    According to the [guide|https://confluence.atlassian.com/doc/installing-confluence-on-linux-143556824.html] of installing Confluence on Linux Server, if the installer is run as root, Confluence will be installed as a service. Although, it doesn't get installed as a service on Ubuntu.  h2. *Testing Environment*    Ubuntu 18.04 LTS   Confluence installer 6.10.1  h2. *Steps to reproduce*   # Download installer of Confluence.   # Add the execute flag to the installer.   # Run the installer as root.    h2. *Expected Results*    Confluence should be installed as a service.  h2. *Actual Result*    Confluence doesn't get installed as a service.  h2. *Workaround*    Installer does create the {{/etc/init.d/confluence}} file, though it doesn't have the run levels in it.  So, if we will directly _enable_ the service, Ubuntu throws an error.  {code}  update-rc.d: error: confluence Default-Start contains no runlevels, aborting.  {code}  We need to add the following lines on the top of {{/etc/init.d/confluence}} file, but after the shebang.  {code:java}  ### BEGIN INIT INFO  # Required-Start:    $all  # Required-Stop:  # Default-Start:     2 3 4 5  # Default-Stop:  ### END INIT INFO  {code}  After the above change, run the following command again to install Confluence as a service.  {code:java}  systemctl enable confluence  {code}    h2. *Diagnosis*    This issue does not happen in CentOS, which means it might be an issue with {{update-rc.d}} scripts in Ubuntu.      """
"CONFSERVER-56183","Bug","Content - History",2,"Multiple collaborators shown even when collaborative editing is off","""h2. Issue Summary    It is currently possible to get into a state where Collaborative Editing is off and the page history still shows multiple contributors.  h2. Steps to reproduce   # Turn off Collaborative Editing.   # Publish a new page (Page History will show it as V1 - Version 1).   # Edit this page as User A and User B at the same time.   # User A and User B commit their changes to the page, creating two new versions.   # Page History shows a version (V3) *Changed By* both users:   !Screen Shot 2018-07-30 at 16.57.25.png|thumbnail!    h2. What happened?    The history shows that both User A and User B contributed to version 3.  h2. What should have happened?    Only one of the users should have contributed to version 2 and 3.  h2. Impact    It is not possible to know through the UI which changes have been introduced by User A and which changes have been introduced by User B.  h2. Workaround    Login as a system administrator, go to the dark features page at <your Confluence url>/admin/darkfeatures.action and add the following dark feature: *collaborative-audit-log.disable*    Page history will now only show the user that published the page in the history."""
"CONFSERVER-56354","Bug","Search - Indexing",5,"User's username remains indexed in search after GDPR steps","""*Description:*    After running GDPR scripts and following listed GDPR steps (including flushing index queue), user's username remains indexed from previous mentions tag when doing a full site search.     *This affects all versions of Confluence.*    *Steps:*   # Mention user on a page and publish it.   # Disable user   # Run scripts   # Clear cache   # Flush queue    # Do a full search for user's username   # Observe username is visible     *Expected:*    No results are returned    *Actual:*    **Search results are returned that have the user's username visible.     !image-2018-08-08-00-20-27-501.png|width=496,height=239!    Clicking on the link shows unknown user   !image-2018-08-08-00-22-32-591.png|width=744,height=56!"""
"CONFSERVER-56238","Bug","Universal Plugin Manager / Manage apps",2,"The bundled Atlassian Universal Plugin Manager plugin had a XXE issue - CVE-2018-20233","""The version of the bundled Atlassian Universal Plugin Manager plugin had a XML External Entity vulnerability that allowed remote attackers with system administrator privileges to read files, make network requests and perform a denial of service attack via an XML External Entity vulnerability in the parsing of atlassian plugin xml files in an uploaded JAR. See https://ecosystem.atlassian.net/browse/UPM-5964 for more details."""
"CONFSERVER-56252","Bug","Editor - Attachment|Editor - Drafts",2,"Drafts can't save attachments via insert option, with Collaborative Editing Off","""h3. *Summary*    With Collaborative Editing *Off* the following situation exists:  * New drafts can't save attachments via upload attachment option.  * Drafts of existing pages can save attachments, as usual.    h3. *Steps to Reproduce*    # Ensure Collaborative Editing is Off.  # Create a new page, give it a title and a few line.  # Select *Close*.  # From the profile picture navigate to Drafts.  # Open the draft for editing again.  # Upload attachment via *Insert files and images* option.    h3. *Expected Results*    The attachment should upload to the draft.    h3. *Actual Results*    The attachment pop-up never gives the option to *Insert*. The only option is to *Close*.    h3. *Workaround*  Try one of the following two:  # Drag and Drop the attachment on to the editor.  # Enable Collaborative Editing.    h3. *Diagnosis*    Confluence returns a 400 bad request to the request from the browser.      The symptoms are similar to CONFSERVER-38719.    If we try an upload again, we see the following error.   !server_ unavailable.png|thumbnail!     In application logs, we see something like following.     h3. *Additional Notes*    Upon testing this in Confluence v6.6.7, this issue doesn't happen. This version actually uses a different request method to upload attachments.  """
"CONFSERVER-56263","Bug","Apps - Confluence Questions",5,"Attachments don't load in Confluence Questions in certain cases","""Tested with: Confluence 6.9.0 + Confluence Questions 2.6.11   Anonymous accessible space + anonymous accessible questions  h3. *Admin user testing*  ||Number||Test Case||Posting user can see image||Another admin in another browser can see it||Non-admin can see it||Anonymous user can see it||  |1|*Admin posted picture into Question*|(/)|(/)|(/)|(/)|  |2|*Admin posted picture into Answer*|(/)|(/)|(x) |(x) |  |3|*Admin edited Answer and re-upload image*|(/)|(/)|(/)|(/)|  |4|*Admin posted image with no text into answer, error returned and then attempt to append text and and save*|(/)|(/)|(/)|(x) |  |5|*Admin posted image with no label into question, error returned and then attempt to append text and and save*|(/)|(/)|(/)|(/)|  |6|*Admin posted picture into Comment under question*|(/)|(/)|(/)|(x)|  |7|*Admin posted picture into Comment under answer*|(/)|(/)|(/)|(x)|  |8|*Admin edited Comment under Qn and re-upload image*|(/)|(/)|(/)|(x) |  |9|*Admin edited Comment under Ans and re-upload image*|(/)|(/)|(/)|(x) |  |10|*Admin posted picture with no text, error returned and then append text into Comment*|(/)|(/)|(/)|(x) |  |11|*Admin posted picture into Answer and 'convert to Comment' off Question*|(/)|(/)|(x)|(x) |  |12|*Admin posted picture into Answer and 'convert to Comment' off Answer*|(/)|(/)|(x)|(x)|  |13|*Admin posted picture into Comment off Answer and 'convert to Answer'*|(/)|(/)|(/)|(x)|  |14|*Admin posted picture into Comment off Question and 'convert to Answer'*|(/)|(/)|(/)|(x) |  h3. *NonAdmin user testing*  ||Number||Test Case||Posting user can see image||Another admin in another browser can see it||Non-admin can see it||Anonymous user can see it||  |1|*Non-Admin posted picture into Question*|(/)|(/)|(/)|(/)|  |2|*Non-Admin posted picture into Answer*|(x) |(/)|(x)|(x) |  |3|*Non-Admin edited Answer and re-upload image*|(/)|(/)|(/)|(/)|  |4|*Non-Admin posted image with no text into answer, error returned and then attempt to append text and and save*|(/)|(/)|(/)|(x) |  |5|*Non-Admin posted image with no label into question, error returned and then attempt to append text and and save*|(/)|(/)|(/)|(/)|  |6|*Non-Admin posted picture into Comment under question*|(/)|(/)|(/)|(x) |  |7|*Non-Admin posted picture into Comment under answer*|(/)|(/)|(/)|(x)|  |8|*Non-Admin edited Comment under Qn and re-upload image*|(/)|(/)|(/)|(x) |  |9|*Non-Admin edited Comment under Ans and re-upload image*|(/)|(/)|(/)|(x) |  |10|*Non-Admin posted picture with no text, error returned and then append text into Comment*|(/)|(/)|(/)|(x)|  |11|*Non-Admin posted picture into Answer and 'convert to Comment' off Question*|(x)|(/)|(x)|(x) |  |12|*Non-Admin posted picture into Answer and 'convert to Comment' off Answer*|(x)|(/)|(x)|(x)|  |13|*Non-Admin posted picture into Comment off Answer and 'convert to Answer'*|(/)|(/)|(/)|(x) |  |14|*Non-Admin posted picture into Comment off Question and 'convert to Answer'*|(/)|(/)|(/)|(x) |    I can confirm that the above failed test cases under *Non-admin can see it* still fails under Confluence 6.10.2 / CQ 2.6.11   I can confirm all other above failed test cases is still failing under Confluence 6.10.2 / CQ 2.6.11  h3. *Viewing by Anonymous User - end user experience*    !NoImages-Qns.png|width=154,height=333!"""
"CONFSERVER-56309","Bug","Macros - Other Macros",3,"Macros nested inside other macros are corrupted if original macro is disabled or not installed","""Confluence will corrupt nested macros inside a unknown macro, leading to data loss in the page storage. The bug lies in the XhtmlContent's implementation and what the class does when a macro definition does not exists or it's not available.    When the xhtmlContent.handleMacroDefinitions method is called with a block of xhtml content which contains a reference to a macro module that has been disabled it will return invalid data - such that it ignores the macros that the disabled macro contains and will conflate the parameters of those macros into the disable MacroDefinition.    xhtmlContent.handleMacroDefinitions will generates invalid data leading to data loss.    In the page we will see this image:   !image1.png|thumbnail!   And if we edit the page, nothing will appear inside the macro:   !image2.png|thumbnail!     The storage format shows that the data exist in the page and the following error appears in the logs:      h4. Replicating the issue    The """"info"""" above is the standard info macro and simple macro was a test macro created to just return the body.    When this situation arises, a call to xhtmlContent.handleMacroDefinitions will result in the first MacroDefinition passed to the MacroDefinitionHandler.handle method being corrupted - the MacroDefinition will have no body, and all of the parameters of the child macros will be conflated into the corrupt definition.    On the event, this bug caused the F4C (Forms for Confluence) migrator to attempt to migrate the content based on invalid data, and thus corrupted the pages.    In the test, if we used the following storage format:    With both """"Simple-macro"""" and """"other-macro"""" enabled, we get these results from the test plugin (which iterates across the macro definitions found by XhtmlContent and outputs the parameters and values)        However, if the """"other-macro"""" have it's module disabled, we see that the """"warn"""" macro content disappears and the arguments are conflated ito the """"other-macro"""" definition.    This will cause data loss on all pages that uses the disabled macro and a separate macro migration tries to use the XhtmlContent to convert markup to MacroDefinition objects so that they can be adjusted and then reformatted out to migrate the content to the new format.    h4. Workaround    Reverting to the page last version fixes the problem, however not all pages have a previous version so it might require a manual intervention to restore an old backup into a staging instance and manually restore lost page contents to production."""
"CONFSERVER-56307","Bug","Content - Edit Files / Companion",2,"Companion app's ""Launch on startup"" does not work if Windows user has username with spaces","""The Atlassian Companion app has an option to """"Launch on startup"""", which creates a registry entry in Windows, for just that.   There is an issue with Windows however, where sometimes, it's unable to launch a program if there's space in between a user name.    For example,   *Does not work:* C:\Users\user name\AppData\Local\atlassian-desktop-companion\Atlassian Companion.exe --was-opened-at-login   *Works:* C:\Users\username\AppData\Local\atlassian-desktop-companion\Atlassian Companion.exe --was-opened-at-login    This seems to be a Windows issue, since it should be able to launch the app, even if the path has spaces in it, but it just does not work on certain Windows install for some reason.   [https://answers.microsoft.com/en-us/windows/forum/all/on-startup-windows-tries-to-open-a-file-but-cant/420aae7f-be93-4f6b-9bc5-b75d01c0fca0]   [https://stackoverflow.com/questions/2919286/getting-the-username-from-the-hkey-users-values]   [https://superuser.com/questions/479105/how-can-i-format-this-path-to-work-as-registry-key-value]   [https://answers.microsoft.com/en-us/windows/forum/windows_10-other_settings/windows-10-upgrade-issue-with-space-in-username/3ea1a411-2c59-4d2a-bda1-d48b9793231f]    *Workaround:*   We can workaround the issue by editing the registry entry, and add quotes around the whole path.   *HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\com.squirrel.atlassian-desktop-companion.AtlassianCompanion*""""C:\Users\user name\AppData\Local\atlassian-desktop-companion\Atlassian Companion.exe --was-opened-at-login"""".    This works, but once the App starts, it updates the path again, and removed the quotes, and so we have to do this again before restart, after the app starts.    *Suggestion:*   We should add quotes around the path as a preventative measure, so that users with this issue are able to have the app launch on startup."""
"CONFSERVER-56317","Suggestion","Content - Attachments|Content - Edit Files / Companion",5,"Direct link to ""edit with"" for attachments without going through preview","""Starting Confluence 6.11, the *View File* macros, which were depreciated since [2015|https://confluence.atlassian.com/conf69/end-of-support-announcements-for-confluence-950285781.html#EndofSupportAnnouncementsforConfluence-DeprecatedmacrosforConfluence(13November2015)], have lost the the *Edit Document* link.   !Capture.PNG|thumbnail!     Since this macro is depreciated, the current supported method of adding files is using the *Insert > Files and Images* option.    To edit the file using the OS's editor, we will first have to preview the file, and trigger the *Edit with* option of the Companion app.    It would be great if we can have a link to directly edit the file, without going through the preview, like we were able to using the *View File* macros before."""
"CONFSERVER-56316","Suggestion","Macros - Attachments",2,"Add back the ""Edit in Office"" option for the  Attachments macro","""In Confluence 6.11, the *Attachments* macro is missing the *Edit in Office* button.   !Capture2.PNG|thumbnail!    This is probably because the option has been depreciated from the *View File* macros, with the addition of the *Confluence Companion App*.   CONFSERVER-56315    There is no mention that this function would be removed from the *Attachments* macro, and so, the option should be there, and be able to work with the *Confluence Companion App* instead.    The current process to edit is to first preview the file, and then use the *Edit with* option.   It would be better if we can have the *Edit with* option without the need to first preview the file.         {panel:title=Atlassian update - 17 June 2019|borderStyle=none|borderColor=#6554c0|titleBGColor=#eae6ff|bgColor=#eae6ff}    We've heard your feedback about the Edit in Office feature and the Companion App, and made some changes to better meet your needs. Read our Community post for all the details:   [Changes to the Companion App in Confluence 6.15.5 and 6.13.6|[https://community.atlassian.com/t5/Confluence-articles/Changes-to-the-Companion-App-in-Confluence-6-15-5-and-6-13-6/ba-p/1108896]]    Thanks    Makisa | Senior Product Manager, Confluence Server    {panel}"""
"CONFSERVER-56353","Bug","Apps - Confluence Questions",3,"Attachments don't load in comments in Confluence Questions","""Steps to reproduce:    - Create new question   - Don't refresh page and also create new comment under that question with attachment  - Don't refresh page and create an answer with an attachment    Expecting  An Attachment in comment will be show     Actual  There is unknown attachment place holder instead of attachment image"""
"CONFSERVER-56414","Bug","Editor - Collaborative editing|Editor - Drafts",5,"Valid drafts are being removed as a stale draft when we restart Collaborative Editing","""h3. Summary  Based on the [removeStaleSharedDrafts class|https://docs.atlassian.com/atlassian-confluence/6.2.0/com/atlassian/confluence/pages/PageManager.html#removeStaleSharedDrafts--], a stale draft is defined as:  {quote}Pages with a {{content_status}} '*draft*' and which have a last modified date that is earlier than or equal to the last modified date on the published page.{quote}  However, it is possible that a draft is marked as stale only by definition but in theory, it is still a valid draft. Refer to the 'Steps to reproduce' section for more information.    h3. Steps to reproduce  # Create a new page and insert a task to the page.  # Publish the page.  # Edit the page again to add some text, then close the editor while opting to save it as a draft.  # Run the query in [How to manually remove Stale Drafts from Confluence Database|https://confluence.atlassian.com/confkb/how-to-manually-remove-stale-drafts-from-confluence-database-951392345.html] to confirm that a stale draft doesn't exist yet in the DB.     # On the page in 'View' mode, mark the task as completed. This creates a new version of the page without the draft being published.  # Run the query in step #4 again and we will see that there is one stale draft.  # Set Collaborative Editing to 'Off' or 'Limited' and then to 'On' to trigger the stale draft removal process.    h3. Expected results  The draft should not be removed despite it fitting the definition/criteria of a stale draft.    h3. Actual results  The draft is removed because the draft's {{lastmoddate}} is earlier than the page's {{lastmoddate}}, which fits the definition of a stale draft.    h3. Workaround  Before turning Collaborative Editing ON you can retrieve information from possibly affected pages by running the query below.  With that information, Confluence administrators will be able to share the draft content if a user asks for it.    This query will list the following attributes:   * Draft ID   * Draft last modify date   * Draft storage format   * Current version pageID   * Link to the current page   * Creator username   * Last modifier username   * Last modify date    {code:language=SQL}  SELECT  DISTINCT(d.contentid) AS DRAFT_ID, d.lastmoddate AS DRAFT_LAST_MOD_DATE, bd.body AS DRAFT_STORAGE_FORMAT, c.contentid AS CURRENT_VERSION_ID, '<Confluence Base URL>/viewpage.action?pageId='||c.contentid AS CURRENT_VERSION_LINK, umc.lower_username AS CURRENT_VERSION_CREATOR, umcm.lower_username AS CURRENT_VERSION_LAST_MODIFIER, c.lastmoddate AS CURRENT_VERSION_LASTMODDATE  FROM CONTENT d  JOIN CONTENT c ON d.prevver = c.contentid  JOIN """"AO_BAF3AA_AOINLINE_TASK"""" i ON d.prevver = i.""""CONTENT_ID""""  JOIN BODYCONTENT bd ON bd.contentid = d.contentid  JOIN USER_MAPPING umc ON umc.user_key = c.creator  JOIN USER_MAPPING umcm ON umcm.user_key = c.lastmodifier  WHERE d.content_status = 'draft'    AND d.prevver IS NOT NULL    AND c.lastmoddate > d.lastmoddate    AND (i.""""COMPLETE_DATE"""" > d.lastmoddate OR i.""""UPDATE_DATE"""" > d.lastmoddate)  ;  {code}"""
"CONFSERVER-56444","Bug","Content - Edit Files / Companion",3,"Edit in App does not work when Confluence is integrated with Crowd SSO","""h2. *Summary*    When clicking on the *Edit with <App>* in the attachment preview page, the registered application (such as Word) will throw an error that downloaded file is corrupt.    h2. *Steps to reproduce*    # Install Confluence 6.11.0 + Companion App  # Attach a word document to a Confluence page  # Click on the word document to show in Preview  # Click on the *Edit with Word*  #* Word opens the document fine (/)  # Now, integrate Confluence with Crowd SSO  #* Repeat the above test by clicking on the *Edit with Word*  #* An error will be thrown back saying 'downloaded file is corrupt' (x)    h2. *Expected Result*    Clicking the *Edit with <App>* should work with Confluence regardless whether Confluence is integrated with Crowd SSO.    h2. *Cause*    When Confluence is integrated with Crowd SSO, the Companion App is unable to download the attachment for editing from Confluence. This results in a login HTML downloaded as the contents of the attachment download.    h2. *Validation*    Open up the Companion App Temp folder and open up the download file.    * *Windows*: C:\Users\username\.atlassian-companion\<hash>\file (Note: The user may need to """"Show hidden files and folders"""" to view this folder)  * *Mac*: ~/.atlassian-companion/<hash>/file    The downloaded file contain HTML contents instead of the actual attachment contents. Renaming this file to .html and opening in a Browser will show that the downloaded contents is a Confluence login page."""
"CONFSERVER-56469","Bug","Content - Edit Files / Companion",3,"""Uploaded from Companion app"" not translated to other supported languages.","""When a new version of an attachment is uploaded after being edited with a Companion App, a comment is added for that version of the attachment that says """"Uploaded from Companion app"""".    If the user uses some other language from their Profile, the sentence above is not translated properly.    !Capture.PNG|width=420,height=186!    In the screenshot above, starting from the bottom, the user's language was set to first, English, then Russian, then Chinese, and the one on top is Spanish."""
